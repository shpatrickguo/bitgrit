
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Neural Network - SMS Text Classification &#8212; shpg-dsprojects</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "shpatrickguo/dsprojects");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "ğŸ’¬ comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Certificates" href="../../achievements/certificates.html" />
    <link rel="prev" title="Neural Network SMS Text Classifier" href="README.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/cat.jpeg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">shpg-dsprojects</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Welcome
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Projects
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../abalone_age/abalone_age.html">
   Estimate Abalone's age
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../doctor_segmentation/doctor_segmentation.html">
   Customer Segmentation for Medical Device Manufacturer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../inn_the_neighborhood/inn_the_neighborhood.html">
   Rental Price Prediction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../concrete_strength/concrete_strength.html">
   Predict Concrete Strength
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chocolate_bars/chocolate_bars.html">
   Finding the best Chocolate Bars
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../travel_assured/travel_assured.html">
   Travel Insurance Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../exam_scores/exam_scores.html">
   Do test preparation courses help you prepare for exams?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../viral_tweets/README.html">
   Viral Tweets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../stock_sentiment_from_headlines/stock_sentiment_from_headlines.html">
   Stock Sentiment Analysis from News Headlines
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../BCG/README.html">
   PowerCo - Is Churn driven by price sensitivity?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../BCG/PowerCo_email.html">
     PowerCo - Proposal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../BCG/eda.html">
     PowerCo - EDA
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="README.html">
   SMS Text Classification
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Neural Network - SMS Text Classification
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Achievements
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../achievements/certificates.html">
   Certifications
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/shpatrickguo/dsprojects/main?urlpath=lab/tree/docs/projects/sms_classifier/sms_classification.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/shpatrickguo/dsprojects/blob/main/docs/projects/sms_classifier/sms_classification.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/shpatrickguo/dsprojects"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/shpatrickguo/dsprojects/issues/new?title=Issue%20on%20page%20%2Fprojects/sms_classifier/sms_classification.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/projects/sms_classifier/sms_classification.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Neural Network - SMS Text Classification
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploratory-data-analysis">
   Exploratory Data Analysis
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wordcloud">
     Wordcloud
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-processing">
   Data Processing
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-imbalance">
     Data Imbalance
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#downsampling">
       Downsampling
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-train-split">
     Test train split
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tokenization">
     Tokenization
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sequencing-and-padding">
     Sequencing and Padding
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dense-spam-detection-model">
   Dense Spam Detection Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#long-short-term-memory-lstm-model">
   Long Short Term Memory (LSTM) Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bi-directional-long-short-term-memory-bilstm-model">
   Bi-directional Long Short Term Memory (BiLSTM) Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#choose-model">
   Choose Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prediction">
   Prediction
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Neural Network - SMS Text Classification</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Neural Network - SMS Text Classification
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploratory-data-analysis">
   Exploratory Data Analysis
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wordcloud">
     Wordcloud
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-processing">
   Data Processing
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-imbalance">
     Data Imbalance
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#downsampling">
       Downsampling
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-train-split">
     Test train split
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tokenization">
     Tokenization
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sequencing-and-padding">
     Sequencing and Padding
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dense-spam-detection-model">
   Dense Spam Detection Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#long-short-term-memory-lstm-model">
   Long Short Term Memory (LSTM) Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bi-directional-long-short-term-memory-bilstm-model">
   Bi-directional Long Short Term Memory (BiLSTM) Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#choose-model">
   Choose Model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prediction">
   Prediction
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="neural-network-sms-text-classification">
<h1>Neural Network - SMS Text Classification<a class="headerlink" href="#neural-network-sms-text-classification" title="Permalink to this headline">#</a></h1>
<p>CreateÂ aÂ machineÂ learningÂ modelÂ thatÂ willÂ classifyÂ SMSÂ messagesÂ asÂ eitherÂ â€œhamâ€Â orÂ â€œspamâ€.Â AÂ â€œhamâ€Â messageÂ isÂ aÂ normalÂ messageÂ sentÂ byÂ aÂ friend.Â AÂ â€œspamâ€Â messageÂ isÂ anÂ advertisementÂ or aÂ messageÂ sentÂ byÂ aÂ company.</p>
<p>CreateÂ aÂ functionÂ calledÂ <code class="docutils literal notranslate"><span class="pre">predict_message</span></code>Â thatÂ takesÂ aÂ messageÂ stringÂ asÂ anÂ argumentÂ andÂ returnsÂ aÂ list.Â TheÂ firstÂ elementÂ inÂ theÂ listÂ shouldÂ beÂ aÂ numberÂ betweenÂ zeroÂ andÂ oneÂ thatÂ indicatesÂ theÂ likelinessÂ ofÂ â€œhamâ€Â (0)Â orÂ â€œspamâ€Â (1).Â TheÂ secondÂ elementÂ inÂ theÂ listÂ shouldÂ beÂ theÂ wordÂ â€œhamâ€Â orÂ â€œspamâ€,Â dependingÂ onÂ whichÂ isÂ mostÂ likely.</p>
<p>Data fromÂ <a class="reference external" href="http://www.dt.fee.unicamp.br/~tiago/smsspamcollection/">SMSÂ SpamÂ CollectionÂ dataset</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#try:
  # %tensorflow_version only exists in Colab.
#  !pip install tf-nightly
#except Exception:
#  pass
#!pip install tensorflow-datasets
#!pip install wordcloud

#!pip install --upgrade numpy
#!pip install --upgrade pandas
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># import libraries
import os
os.environ[&#39;TF_CPP_MIN_LOG_LEVEL&#39;] = &#39;2&#39;

import tensorflow as tf
import pandas as pd
from tensorflow import keras
import tensorflow_datasets as tfds
import numpy as np
import matplotlib.pyplot as plt

import seaborn as sns
from wordcloud import WordCloud, STOPWORDS, ImageColorGenerator

from sklearn.model_selection import train_test_split
from tensorflow.keras.preprocessing.text import Tokenizer
from tensorflow.keras.preprocessing.sequence import pad_sequences

# Modeling 
from tensorflow.keras.callbacks import EarlyStopping
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Embedding, GlobalAveragePooling1D, Dense, Dropout, LSTM, Bidirectional, Flatten

print(tf.__version__)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.11.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># get data files
#!wget https://cdn.freecodecamp.org/project-data/sms/train-data.tsv
#!wget https://cdn.freecodecamp.org/project-data/sms/valid-data.tsv

train_file_path = &quot;data/train-data.tsv&quot;
test_file_path = &quot;data/valid-data.tsv&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># load data files
train_file = pd.read_csv(train_file_path, sep=&#39;\t&#39;, names=[&quot;Class&quot;, &quot;Message&quot;])
test_file = pd.read_csv(test_file_path, sep=&#39;\t&#39;, names=[&quot;Class&quot;, &quot;Message&quot;])
</pre></div>
</div>
</div>
</div>
<p>The file is tab separated (\t) and I provide column names â€œClassâ€ and â€œMessageâ€.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="exploratory-data-analysis">
<h1>Exploratory Data Analysis<a class="headerlink" href="#exploratory-data-analysis" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>train_file.describe()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Class</th>
      <th>Message</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4179</td>
      <td>4179</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>2</td>
      <td>3935</td>
    </tr>
    <tr>
      <th>top</th>
      <td>ham</td>
      <td>sorry, i'll call later</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>3619</td>
      <td>22</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>There are two unique classes: â€œhamâ€ and â€œspamâ€. There are less unique messages (3935) than total message count (4179) indicating some repeated messages.
The top class is â€œhamâ€ and the top message is â€œsorry, iâ€™ll call laterâ€.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>train_file.groupby(&quot;Class&quot;).describe().T
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Class</th>
      <th>ham</th>
      <th>spam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="4" valign="top">Message</th>
      <th>count</th>
      <td>3619</td>
      <td>560</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>3430</td>
      <td>505</td>
    </tr>
    <tr>
      <th>top</th>
      <td>sorry, i'll call later</td>
      <td>hmv bonus special 500 pounds of genuine hmv vo...</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>22</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>There are 3619 ham compared to 560 spam messages. This means the data is imbalanced. The most popular ham message â€œsorry, iâ€™ll call laterâ€ occured 22 times. Whereas the most popular spam message â€œhmv bonus special 500 pounds of genuine hmvâ€¦â€ occured 3 times.</p>
<section id="wordcloud">
<h2>Wordcloud<a class="headerlink" href="#wordcloud" title="Permalink to this headline">#</a></h2>
<p>Wordcloud allows us to visualize the most frequent words in the given text.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Get all the ham and spam emails
train_ham = train_file[train_file.Class ==&#39;ham&#39;]
train_spam = train_file[train_file.Class ==&#39;spam&#39;]
# Create numpy list to visualize using wordcloud
train_ham_text = &quot; &quot;.join(train_ham.Message.to_numpy().tolist())
train_spam_text = &quot; &quot;.join(train_spam.Message.to_numpy().tolist())
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># wordcloud of ham messages
ham_msg_cloud = WordCloud(width=520, height=260, stopwords=STOPWORDS, max_font_size=50, 
                          background_color=&quot;black&quot;, colormap=&#39;Blues&#39;).generate(train_ham_text)
plt.figure(figsize=(16,10))
plt.imshow(ham_msg_cloud, interpolation=&#39;bilinear&#39;)
plt.axis(&#39;off&#39;) # turn off axis
plt.show()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/sms_classification_13_0.png" src="../../_images/sms_classification_13_0.png" />
</div>
</div>
<p>The ham message WordCloud shows that â€œloveâ€, â€œgoingâ€, â€œcomeâ€, â€œhomeâ€, etc. are the most commonly appeared words in ham messages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># wordcloud of spam messages
spam_msg_cloud = WordCloud(width=520, height=260, stopwords=STOPWORDS, max_font_size=50, 
                           background_color=&quot;black&quot;, colormap=&#39;Blues&#39;).generate(train_spam_text)
plt.figure(figsize=(16,10))
plt.imshow(spam_msg_cloud, interpolation=&#39;bilinear&#39;)
plt.axis(&#39;off&#39;) # turn off axis
plt.show()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/sms_classification_15_0.png" src="../../_images/sms_classification_15_0.png" />
</div>
</div>
<p>The spam message WordCloud shows that â€œfreeâ€, â€œtextâ€, â€œcallâ€ etc. are the most commonly appeared words in spam messages.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-processing">
<h1>Data Processing<a class="headerlink" href="#data-processing" title="Permalink to this headline">#</a></h1>
<section id="data-imbalance">
<h2>Data Imbalance<a class="headerlink" href="#data-imbalance" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Percentage of spam messages
len(train_spam)/len(train_ham)*100 # 15.48%

# Countplot showing imbalance data
plt.figure(figsize=(8,6))
sns.countplot(x=&quot;Class&quot;, data=train_file)
plt.show()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/sms_classification_19_0.png" src="../../_images/sms_classification_19_0.png" />
</div>
</div>
<p>The bar chart shows that the classes are imbalanced. 85% of the messages are ham.</p>
<section id="downsampling">
<h3>Downsampling<a class="headerlink" href="#downsampling" title="Permalink to this headline">#</a></h3>
<p>To handle the imbalance data, we downsample.
Downsampling randomly deletes some of the observations from the majority class so that the numbers in majority and minority classes are matched.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Downsample the ham msg for train
train_ham_df = train_ham.sample(n = len(train_spam), random_state = 44)
train_spam_df = train_spam
print(train_ham_df.shape, train_spam_df.shape)
train_df = pd.concat([train_ham_df, train_spam_df]).reset_index(drop=True)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(560, 2) (560, 2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Downsample for test file
test_ham = test_file[test_file.Class ==&#39;ham&#39;]
test_spam = test_file[test_file.Class ==&#39;spam&#39;]

# Downsample the ham msg for test
test_ham_df = test_ham.sample(n = len(test_spam), random_state = 44)
test_spam_df = test_spam
print(test_ham_df.shape, test_spam_df.shape)
test_df = pd.concat([test_ham_df, test_spam_df]).reset_index(drop=True)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(187, 2) (187, 2)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="test-train-split">
<h2>Test train split<a class="headerlink" href="#test-train-split" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Map ham label as 0 and spam as 1
train_df[&#39;msg_type&#39;]= train_df[&#39;Class&#39;].map({&#39;ham&#39;: 0, &#39;spam&#39;: 1})
test_df[&#39;msg_type&#39;]= test_df[&#39;Class&#39;].map({&#39;ham&#39;: 0, &#39;spam&#39;: 1})


train_msg = train_df[&#39;Message&#39;]
train_labels = train_df[&#39;msg_type&#39;].values
test_msg = test_df[&#39;Message&#39;]
test_labels = test_df[&#39;msg_type&#39;].values
</pre></div>
</div>
</div>
</div>
</section>
<section id="tokenization">
<h2>Tokenization<a class="headerlink" href="#tokenization" title="Permalink to this headline">#</a></h2>
<p>Tokenizer API from TensorFlow Keras splits sentences into words and encodes them into integers.</p>
<ul class="simple">
<li><p>Tokenize into words</p></li>
<li><p>Filter out punctuation and rare words</p></li>
<li><p>Convert all words to lower case and to integer index</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Defining tokenizer hyperparameters
max_len = 50 
trunc_type = &quot;post&quot; 
padding_type = &quot;post&quot; 
oov_tok = &quot;&lt;OOV&gt;&quot; 
vocab_size = 500
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>tokenizer = Tokenizer(num_words = vocab_size, char_level=False, oov_token = oov_tok)
tokenizer.fit_on_texts(train_msg)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Get the word_index 
word_index = tokenizer.word_index
# How many words 
tot_words = len(word_index)
print(&#39;There are %s unique tokens in training data. &#39; % tot_words)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 3999 unique tokens in training data. 
</pre></div>
</div>
</div>
</div>
</section>
<section id="sequencing-and-padding">
<h2>Sequencing and Padding<a class="headerlink" href="#sequencing-and-padding" title="Permalink to this headline">#</a></h2>
<p>Use texts_tosequences() to espresent each sentence by sequences of numbers from tokenizer object.</p>
<p>Use pad_sequences() so that each sequences have the same length.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Sequencing and padding on training and testing 
training_sequences = tokenizer.texts_to_sequences(train_msg)
training_padded = pad_sequences (training_sequences, maxlen = max_len, padding = padding_type, truncating = trunc_type)
testing_sequences = tokenizer.texts_to_sequences(test_msg)
testing_padded = pad_sequences(testing_sequences, maxlen = max_len,
                                padding = padding_type, truncating = trunc_type)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Shape of train tensor
print(&#39;Shape of training tensor: &#39;, training_padded.shape)
print(&#39;Shape of testing tensor: &#39;, testing_padded.shape)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shape of training tensor:  (1120, 50)
Shape of testing tensor:  (374, 50)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="dense-spam-detection-model">
<h1>Dense Spam Detection Model<a class="headerlink" href="#dense-spam-detection-model" title="Permalink to this headline">#</a></h1>
<p>Train model using a Dense architecture followed by LSTM and Bi-LSTM.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># hyper-parameters
vocab_size = 500 
embeding_dim = 16
drop_value = 0.2 
n_dense = 24
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Dense model architecture
dense_model = Sequential()
dense_model.add(Embedding(vocab_size, embeding_dim, input_length=max_len))
dense_model.add(GlobalAveragePooling1D())
dense_model.add(Dense(24, activation=&#39;relu&#39;))
dense_model.add(Dropout(drop_value))
dense_model.add(Dense(1, activation=&#39;sigmoid&#39;))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dense_model.compile(loss=&#39;binary_crossentropy&#39;, optimizer=&#39;adam&#39;, metrics=[&#39;accuracy&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># fitting a dense spam detector model
num_epochs = 30
early_stop = EarlyStopping(monitor=&#39;val_loss&#39;, patience=3)
history = dense_model.fit(training_padded, train_labels, epochs=num_epochs, 
                    validation_data=(testing_padded, test_labels), 
                    callbacks =[early_stop], verbose=2)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 1s - loss: 0.6814 - accuracy: 0.5018 - val_loss: 0.6689 - val_accuracy: 0.5107 - 893ms/epoch - 26ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 2/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.6507 - accuracy: 0.6098 - val_loss: 0.6229 - val_accuracy: 0.6952 - 81ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 3/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.5899 - accuracy: 0.7241 - val_loss: 0.5551 - val_accuracy: 0.8021 - 72ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 4/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.5207 - accuracy: 0.8268 - val_loss: 0.4942 - val_accuracy: 0.8396 - 79ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 5/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.4598 - accuracy: 0.8795 - val_loss: 0.4455 - val_accuracy: 0.8690 - 81ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 6/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.4097 - accuracy: 0.8991 - val_loss: 0.3998 - val_accuracy: 0.8877 - 72ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 7/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.3576 - accuracy: 0.9143 - val_loss: 0.3545 - val_accuracy: 0.8957 - 71ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 8/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.3118 - accuracy: 0.9214 - val_loss: 0.3067 - val_accuracy: 0.9064 - 79ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 9/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.2676 - accuracy: 0.9295 - val_loss: 0.2638 - val_accuracy: 0.9144 - 79ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 10/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.2302 - accuracy: 0.9491 - val_loss: 0.2326 - val_accuracy: 0.9251 - 80ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 11/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.2006 - accuracy: 0.9491 - val_loss: 0.2019 - val_accuracy: 0.9305 - 81ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 12/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.1779 - accuracy: 0.9571 - val_loss: 0.1808 - val_accuracy: 0.9358 - 71ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 13/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.1504 - accuracy: 0.9670 - val_loss: 0.1672 - val_accuracy: 0.9385 - 81ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 14/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.1417 - accuracy: 0.9670 - val_loss: 0.1504 - val_accuracy: 0.9439 - 79ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 15/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.1249 - accuracy: 0.9643 - val_loss: 0.1421 - val_accuracy: 0.9519 - 80ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 16/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.1162 - accuracy: 0.9723 - val_loss: 0.1363 - val_accuracy: 0.9519 - 80ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 17/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.1063 - accuracy: 0.9741 - val_loss: 0.1289 - val_accuracy: 0.9572 - 81ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 18/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.0984 - accuracy: 0.9723 - val_loss: 0.1218 - val_accuracy: 0.9545 - 72ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 19/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.0921 - accuracy: 0.9732 - val_loss: 0.1175 - val_accuracy: 0.9572 - 72ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 20/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.0817 - accuracy: 0.9750 - val_loss: 0.1143 - val_accuracy: 0.9572 - 84ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 21/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.0806 - accuracy: 0.9741 - val_loss: 0.1117 - val_accuracy: 0.9572 - 79ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 22/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.0769 - accuracy: 0.9741 - val_loss: 0.1103 - val_accuracy: 0.9599 - 79ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 23/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.0729 - accuracy: 0.9786 - val_loss: 0.1081 - val_accuracy: 0.9599 - 79ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 24/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.0602 - accuracy: 0.9812 - val_loss: 0.1067 - val_accuracy: 0.9599 - 80ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 25/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.0606 - accuracy: 0.9830 - val_loss: 0.1042 - val_accuracy: 0.9626 - 81ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 26/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.0558 - accuracy: 0.9857 - val_loss: 0.1068 - val_accuracy: 0.9599 - 71ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 27/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.0524 - accuracy: 0.9821 - val_loss: 0.1031 - val_accuracy: 0.9626 - 81ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 28/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.0503 - accuracy: 0.9848 - val_loss: 0.1044 - val_accuracy: 0.9599 - 79ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 29/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.0475 - accuracy: 0.9848 - val_loss: 0.1038 - val_accuracy: 0.9652 - 80ms/epoch - 2ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 30/30
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>35/35 - 0s - loss: 0.0441 - accuracy: 0.9857 - val_loss: 0.1019 - val_accuracy: 0.9626 - 80ms/epoch - 2ms/step
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Model performance on test data 
dense_model.evaluate(testing_padded, test_labels)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 1/12 [=&gt;............................] - ETA: 0s - loss: 0.1214 - accuracy: 0.9375
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
12/12 [==============================] - 0s 1ms/step - loss: 0.1019 - accuracy: 0.9626
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.10189428925514221, 0.9625668525695801]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Read as a dataframe 
metrics = pd.DataFrame(history.history)
# Rename column
metrics.rename(columns = {&#39;loss&#39;: &#39;Training_Loss&#39;, &#39;accuracy&#39;: &#39;Training_Accuracy&#39;, &#39;val_loss&#39;: &#39;Validation_Loss&#39;, &#39;val_accuracy&#39;: &#39;Validation_Accuracy&#39;}, inplace = True)
def plot_dense(var1, var2, string):
    metrics[[var1, var2]].plot()
    plt.title(&#39;Training and Validation &#39; + string)
    plt.xlabel (&#39;Number of epochs&#39;)
    plt.ylabel(string)
    plt.legend([var1, var2])

plot_dense(&#39;Training_Loss&#39;, &#39;Validation_Loss&#39;, &#39;loss&#39;)
plot_dense(&#39;Training_Accuracy&#39;, &#39;Validation_Accuracy&#39;, &#39;accuracy&#39;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/sms_classification_39_0.png" src="../../_images/sms_classification_39_0.png" />
<img alt="../../_images/sms_classification_39_1.png" src="../../_images/sms_classification_39_1.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="long-short-term-memory-lstm-model">
<h1>Long Short Term Memory (LSTM) Model<a class="headerlink" href="#long-short-term-memory-lstm-model" title="Permalink to this headline">#</a></h1>
<p>This neural network is capable of learning order dependence in sequence prediction problems.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># LSTM hyperparameters
n_lstm = 20
drop_lstm =0.2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># LSTM Spam detection architecture
LSTM_model = Sequential()
LSTM_model.add(Embedding(vocab_size, embeding_dim, input_length=max_len))
LSTM_model.add(LSTM(n_lstm, dropout=drop_lstm, return_sequences=True))
LSTM_model.add(LSTM(n_lstm, dropout=drop_lstm, return_sequences=True))
LSTM_model.add(Dense(1, activation=&#39;sigmoid&#39;))
LSTM_model.add(GlobalAveragePooling1D())
#LSTM_model.add(Flatten())
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>LSTM_model.compile(loss = &#39;binary_crossentropy&#39;, optimizer = &#39;adam&#39;, metrics=[&#39;accuracy&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>num_epochs = 30
early_stop = EarlyStopping(monitor=&#39;val_loss&#39;, patience=2)
history = LSTM_model.fit(training_padded, train_labels, epochs=num_epochs, validation_data=(testing_padded, test_labels), callbacks =[early_stop], verbose=0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Create a dataframe
metrics = pd.DataFrame(history.history)
# Rename column
metrics.rename(columns = {&#39;loss&#39;: &#39;Training_Loss&#39;, &#39;accuracy&#39;: &#39;Training_Accuracy&#39;,
                         &#39;val_loss&#39;: &#39;Validation_Loss&#39;, &#39;val_accuracy&#39;: &#39;Validation_Accuracy&#39;}, inplace = True)
def plot_LSTM(var1, var2, string):
    metrics[[var1, var2]].plot()
    plt.title(&#39;LSTM Model: Training and Validation &#39; + string)
    plt.xlabel (&#39;Number of epochs&#39;)
    plt.ylabel(string)
    plt.legend([var1, var2])
plot_LSTM(&#39;Training_Loss&#39;, &#39;Validation_Loss&#39;, &#39;loss&#39;)
plot_LSTM(&#39;Training_Accuracy&#39;, &#39;Validation_Accuracy&#39;, &#39;accuracy&#39;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/sms_classification_45_0.png" src="../../_images/sms_classification_45_0.png" />
<img alt="../../_images/sms_classification_45_1.png" src="../../_images/sms_classification_45_1.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="bi-directional-long-short-term-memory-bilstm-model">
<h1>Bi-directional Long Short Term Memory (BiLSTM) Model<a class="headerlink" href="#bi-directional-long-short-term-memory-bilstm-model" title="Permalink to this headline">#</a></h1>
<p>Bi-LSTM learns patterns from before and after a given token.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Biderectional LSTM Spam detection architecture
biLSTM_model = Sequential()
biLSTM_model.add(Embedding(vocab_size, embeding_dim, input_length=max_len))
biLSTM_model.add(Bidirectional(LSTM(n_lstm, dropout=drop_lstm, return_sequences=True)))
biLSTM_model.add(Dense(1, activation=&#39;sigmoid&#39;))
biLSTM_model.add(GlobalAveragePooling1D())
#biLSTM_model.add(Flatten())
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>biLSTM_model.compile(loss = &#39;binary_crossentropy&#39;, optimizer = &#39;adam&#39;, metrics=[&#39;accuracy&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Training
num_epochs = 30
early_stop = EarlyStopping(monitor=&#39;val_loss&#39;, patience=2)
history = biLSTM_model.fit(training_padded, train_labels, epochs=num_epochs, 
                    validation_data=(testing_padded, test_labels),callbacks =[early_stop], verbose=0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Create a dataframe
metrics = pd.DataFrame(history.history)
# Rename column
metrics.rename(columns = {&#39;loss&#39;: &#39;Training_Loss&#39;, &#39;accuracy&#39;: &#39;Training_Accuracy&#39;,
                         &#39;val_loss&#39;: &#39;Validation_Loss&#39;, &#39;val_accuracy&#39;: &#39;Validation_Accuracy&#39;}, inplace = True)
def plot_biLSTM(var1, var2, string):
    metrics[[var1, var2]].plot()
    plt.title(&#39;BiLSTM Model: Training and Validation &#39; + string)
    plt.xlabel (&#39;Number of epochs&#39;)
    plt.ylabel(string)
    plt.legend([var1, var2])
# Plot
plot_biLSTM(&#39;Training_Loss&#39;, &#39;Validation_Loss&#39;, &#39;loss&#39;)
plot_biLSTM(&#39;Training_Accuracy&#39;, &#39;Validation_Accuracy&#39;, &#39;accuracy&#39;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/sms_classification_50_0.png" src="../../_images/sms_classification_50_0.png" />
<img alt="../../_images/sms_classification_50_1.png" src="../../_images/sms_classification_50_1.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="choose-model">
<h1>Choose Model<a class="headerlink" href="#choose-model" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Comparing three different models
print(f&quot;Dense architecture loss and accuracy: {dense_model.evaluate(testing_padded, test_labels)} &quot; )
print(f&quot;LSTM architecture loss and accuracy: {LSTM_model.evaluate(testing_padded, test_labels)} &quot; )
print(f&quot;Bi-LSTM architecture loss and accuracy: {biLSTM_model.evaluate(testing_padded, test_labels)} &quot; )
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 1/12 [=&gt;............................] - ETA: 0s - loss: 0.1214 - accuracy: 0.9375
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
12/12 [==============================] - 0s 1ms/step - loss: 0.1019 - accuracy: 0.9626
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dense architecture loss and accuracy: [0.10189428925514221, 0.9625668525695801] 

 1/12 [=&gt;............................] - ETA: 0s - loss: 0.4323 - accuracy: 0.8750
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
 9/12 [=====================&gt;........] - ETA: 0s - loss: 0.1566 - accuracy: 0.9618
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
12/12 [==============================] - 0s 7ms/step - loss: 0.1473 - accuracy: 0.9599
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LSTM architecture loss and accuracy: [0.1472780406475067, 0.9598930478096008] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 1/12 [=&gt;............................] - ETA: 0s - loss: 0.3490 - accuracy: 0.9375
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
12/12 [==============================] - 0s 4ms/step - loss: 0.1242 - accuracy: 0.9626
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Bi-LSTM architecture loss and accuracy: [0.12423283606767654, 0.9625668525695801] 
</pre></div>
</div>
</div>
</div>
<p>Based on loss, accuracy and the plots above, we select the Dense architecture as the final model for classifying whether messages are spam or ham.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="prediction">
<h1>Prediction<a class="headerlink" href="#prediction" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># function to predict messages based on model
# (should return list containing prediction and label, ex. [0.008318834938108921, &#39;ham&#39;])
def predict_message(pred_text):
    pred_text = [pred_text]
    new_seq = tokenizer.texts_to_sequences(pred_text)
    padded = pad_sequences(new_seq, maxlen=max_len,
                      padding = padding_type,
                      truncating=trunc_type)
    prediction = (dense_model.predict(padded))[0][0]
    if prediction &lt; 0.5:
        return [prediction, &#39;ham&#39;]
    else:
        return [prediction, &#39;spam&#39;]
pred_text = &quot;how are you doing today?&quot;

prediction = predict_message(pred_text)
print(prediction)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/1 [==============================] - ETA: 0s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
1/1 [==============================] - 0s 78ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.002020515, &#39;ham&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Run this cell to test your function and model. 
def test_predictions():
    test_messages = [&quot;how are you doing today&quot;,
                   &quot;sale today! to stop texts call 98912460324&quot;,
                   &quot;i dont want to go. can we try it a different day? available sat&quot;,
                   &quot;our new mobile video service is live. just install on your phone to start watching.&quot;,
                   &quot;you have won Â£1000 cash! call to claim your prize.&quot;,
                   &quot;i&#39;ll bring it tomorrow. don&#39;t forget the milk.&quot;,
                   &quot;wow, is your arm alright. that happened to me one time too&quot;
                  ]

    test_answers = [&quot;ham&quot;, &quot;spam&quot;, &quot;ham&quot;, &quot;spam&quot;, &quot;spam&quot;, &quot;ham&quot;, &quot;ham&quot;]
    passed = True

    for msg, ans in zip(test_messages, test_answers):
        prediction = predict_message(msg)
        if prediction[1] != ans:
            passed = False

    if passed:
        print(&quot;You passed the challenge. Great job!&quot;)
    else:
        print(&quot;You haven&#39;t passed yet. Keep trying.&quot;)

test_predictions()
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/1 [==============================] - ETA: 0s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
1/1 [==============================] - 0s 17ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/1 [==============================] - ETA: 0s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
1/1 [==============================] - 0s 18ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/1 [==============================] - ETA: 0s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
1/1 [==============================] - 0s 17ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/1 [==============================] - ETA: 0s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
1/1 [==============================] - 0s 17ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/1 [==============================] - ETA: 0s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
1/1 [==============================] - 0s 17ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/1 [==============================] - ETA: 0s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
1/1 [==============================] - 0s 17ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/1 [==============================] - ETA: 0s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
1/1 [==============================] - 0s 16ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>You haven&#39;t passed yet. Keep trying.
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./projects/sms_classifier"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="README.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="xref myst">Neural Network SMS Text Classifier</span></p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../achievements/certificates.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Certificates</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Patrick Guo<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>