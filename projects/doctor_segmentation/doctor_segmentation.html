
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Segmenting customers of medical device manufacturer &#8212; shpg-dsprojects</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/quantecon-book-theme.1ef59f8f4e91ec8319176e8479c6af4e.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">


    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "shpatrickguo/dsprojects");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "💬 comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script src="../../_static/quantecon-book-theme.15b0c36fffe88f468997fa7b698991d3.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Inn the Neighborhood - Rental Price Prediction" href="../inn_the_neighborhood/inn_the_neighborhood.html" />
    <link rel="prev" title="Welcome" href="../../intro.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Patrick Guo" />
<meta name="keywords" content="" />
<meta name="description" content=Segmenting customers of medical device manufacturer  1.1 Background  A medical device manufacturer in Switzerland manufactures orthopedic devices and sells them />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:title" content="Segmenting customers of medical device manufacturer"/>
<meta name="twitter:description" content="Segmenting customers of medical device manufacturer  1.1 Background  A medical device manufacturer in Switzerland manufactures orthopedic devices and sells them">
<meta name="twitter:creator" content="@">
<meta name="twitter:image" content="">

<!-- Opengraph tags -->
<meta property="og:title" content="Segmenting customers of medical device manufacturer" />
<meta property="og:type" content="website" />
<meta property="og:url" content="None" />
<meta property="og:image" content="" />
<meta property="og:description" content="Segmenting customers of medical device manufacturer  1.1 Background  A medical device manufacturer in Switzerland manufactures orthopedic devices and sells them" />
<meta property="og:site_name" content="shpg-dsprojects" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=projects/doctor_segmentation/doctor_segmentation>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background">
   1.1 Background
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#business-qustions">
   1.2 Business Qustions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-dataset">
   2 The dataset
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imports">
     2.1 Imports
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-data">
     2.2 Load data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-data">
     💾 The data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#doctors-contains-information-on-doctors-each-row-represents-one-doctor">
       Doctors contains information on doctors. Each row represents one doctor.
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#orders-contains-details-on-orders-each-row-represents-one-order-a-doctor-can-place-multiple-orders">
       Orders contains details on orders. Each row represents one order; a doctor can place multiple orders.
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#complaints-collects-information-on-doctor-complaints">
       Complaints collects information on doctor complaints.
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#instructions-has-information-on-whether-the-doctor-includes-special-instructions-on-their-orders">
       Instructions has information on whether the doctor includes special instructions on their orders.
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#buisness-questions">
   3 Buisness Questions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-many-doctors-are-there-in-each-region">
     3.1 How many doctors are there in each region?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-is-the-average-number-of-purchases-per-region">
     3.2 What is the average number of purchases per region?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#can-you-find-a-relationship-between-purchases-and-complaints">
     3.3 Can you find a relationship between purchases and complaints?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploratory-data-analysis-eda">
   4 Exploratory Data Analysis (EDA)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#region">
     4.1 Region
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#category">
     4.2 Category
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rank">
     4.3 Rank
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#incidence-rate">
     4.4 Incidence rate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#r-rate">
     4.5 R rate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#satisfaction">
     4.6 Satisfaction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#experience">
     4.7 Experience
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#purchases">
     4.8 Purchases
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#condition-a-j">
     4.9 Condition A-J
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#complaint-type">
     4.10 Complaint Type
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#qty">
     4.11 Qty
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#instructions">
     4.12 Instructions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-selection-and-engineering">
   5 Feature Selection and Engineering
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dropping-identifiers-filling-missing-values-and-encoding">
     5.1 Dropping identifiers, filling missing values, and encoding
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feature-scaling">
     5.2 Feature Scaling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#principal-component-analysis-pca">
     5.3 Principal Component Analysis (PCA)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-new-doctor-segments">
   6 Define new doctor segments
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimal-number-of-clusters">
     6.1 Optimal number of clusters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#kmeans-clustering">
     6.2 KMeans clustering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#which-features-impact-the-new-segmentation-strategy-the-most">
     6.3 Which features impact the new segmentation strategy the most
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#characteristics-that-distinguish-the-newly-defined-segments">
   7 Characteristics that distinguish the newly defined segments
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rank-vs-purchases">
     7.1 Rank vs Purchases
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rank-vs-incidence-rate-and-r-rate">
     7.2 Rank vs Incidence rate and R rate
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   8. Conclusion
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#next-steps">
     8.1 Next steps
    </a>
   </li>
  </ul>
 </li>
</ul>

                            <p class="logo">
                                
                                    
                                    <a href="../../intro.html"><img src="../../_static/cat.jpeg" class="logo" alt="logo"></a>
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="../../intro.html">shpg-dsprojects</a></p>

                        <p class="qe-page__header-subheading">Segmenting customers of medical device manufacturer</p>

                    </div>

                    <p class="qe-page__header-authors">Patrick Guo</p>

                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <div class="tex2jax_ignore mathjax_ignore section" id="segmenting-customers-of-medical-device-manufacturer">
<h1><a class="reference external" href="https://app.datacamp.com/workspace/w/340ba6a8-af75-4ee0-99f5-cb1a22acffba">Segmenting customers of medical device manufacturer</a><a class="headerlink" href="#segmenting-customers-of-medical-device-manufacturer" title="Permalink to this headline">¶</a></h1>
<div class="section" id="background">
<h2>1.1 Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>A medical device manufacturer in Switzerland manufactures orthopedic devices and sells them worldwide. The company sells directly to individual doctors who use them on rehabilitation and physical therapy patients. <br>
Historically, the sales and customer support departments have grouped doctors by geography. However, the region is not a good predictor of the number of purchases a doctor will make or their support needs. <br>
The team wants to use a data-centric approach to segmenting doctors to improve marketing, customer service, and product planning.</p>
</div>
<div class="section" id="business-qustions">
<h2>1.2 Business Qustions<a class="headerlink" href="#business-qustions" title="Permalink to this headline">¶</a></h2>
<p>Before making a segmentation to the team, we shall focus on answering the following five business questions:</p>
<ol class="simple">
<li><p>How many doctors are there in each region? What is the average number of purchases per region?</p></li>
<li><p>Can you find a relationship between purchases and complaints?</p></li>
<li><p>Define new doctor segments that help the company improve marketing efforts and customer service.</p></li>
<li><p>Identify which features impact the new segmentation strategy the most.</p></li>
<li><p>Describe which characteristics distinguish the newly defined segments.</p></li>
</ol>
</div>
<div class="section" id="the-dataset">
<h2>2 The dataset<a class="headerlink" href="#the-dataset" title="Permalink to this headline">¶</a></h2>
<div class="section" id="imports">
<h3>2.1 Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h3>
<p>First, let’s load all the modules that will be used in this report.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">import</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">missingno</span> <span class="k">as</span> <span class="nn">msno</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span><span class="p">,</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">yellowbrick.cluster</span> <span class="kn">import</span> <span class="n">KElbowVisualizer</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;darkgrid&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creates function to generate a data quality report</span>
<span class="k">def</span> <span class="nf">dqr</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a data quality report</span>
<span class="sd">    </span>
<span class="sd">    ARGS:</span>
<span class="sd">    df (dataframe): Pandas dataframe</span>
<span class="sd">    </span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    dq_report: First few rows of dataframe, descriptive statistics, and other info such as missing data and unique values etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    
    <span class="c1"># data type</span>
    <span class="n">data_types</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Data Type&#39;</span><span class="p">])</span>
  
    <span class="c1"># missing data</span>
    <span class="n">missing_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Missing Values&#39;</span><span class="p">])</span>

    <span class="c1"># unique values</span>
    <span class="n">unique_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Unique Values&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
        <span class="n">unique_values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()]</span>
    
    <span class="c1"># number of records</span>
    <span class="n">count_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
        <span class="n">count_values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()]</span>
        
    <span class="c1"># join columns </span>
    <span class="n">dq_report</span> <span class="o">=</span> <span class="n">data_types</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">count_values</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing_data</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)</span>
  
    <span class="c1"># percentage missing</span>
    <span class="n">dq_report</span><span class="p">[</span><span class="s1">&#39;Missing %&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dq_report</span><span class="p">[</span><span class="s1">&#39;Missing Values&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  
    <span class="c1"># change order of columns</span>
    <span class="n">dq_report</span> <span class="o">=</span> <span class="n">dq_report</span><span class="p">[[</span><span class="s1">&#39;Data Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Records&#39;</span><span class="p">,</span> <span class="s1">&#39;Unique Values&#39;</span><span class="p">,</span> <span class="s1">&#39;Missing Values&#39;</span><span class="p">,</span> <span class="s1">&#39;Missing %&#39;</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">dq_report</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create function to display values on seaborn barplot</span>
<span class="k">def</span> <span class="nf">show_values_on_bars</span><span class="p">(</span><span class="n">axs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display values on seaborn barplot</span>
<span class="sd">    </span>
<span class="sd">    ARGS:</span>
<span class="sd">    axs: seaborn barplot</span>
<span class="sd">    </span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    Updates axs with values shown on barplot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_show_on_single_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>        
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="n">_x</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">_y</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_y</span><span class="p">()</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.05</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span> 

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">axs</span><span class="p">):</span>
            <span class="n">_show_on_single_plot</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_show_on_single_plot</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create function to remove outliers from dataframe</span>
<span class="k">def</span> <span class="nf">remove_outliers</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove outliers from datafrome</span>
<span class="sd">    </span>
<span class="sd">    ARGS:</span>
<span class="sd">    df (dataframe): Pandas dataframe</span>
<span class="sd">    </span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    Removes outliers greater than 1.5*IQR from numerical columns in dataframe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">numerical</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;Int64&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">numerical</span><span class="p">]:</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">q3</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">low</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">high</span><span class="p">),</span> <span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-data">
<h3>2.2 Load data<a class="headerlink" href="#load-data" title="Permalink to this headline">¶</a></h3>
<p>Next, let’s load the data and explore the basic contents for each dataframe: the type of the variables, whether there are null values.</p>
</div>
<div class="section" id="the-data">
<h3>💾 The data<a class="headerlink" href="#the-data" title="Permalink to this headline">¶</a></h3>
<p>The company stores the information you need in the following four tables. Some of the fields are anonymized to comply with privacy regulations.</p>
<div class="section" id="doctors-contains-information-on-doctors-each-row-represents-one-doctor">
<h4>Doctors contains information on doctors. Each row represents one doctor.<a class="headerlink" href="#doctors-contains-information-on-doctors-each-row-represents-one-doctor" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>“DoctorID” - is a unique identifier for each doctor.</p></li>
<li><p>“Region” - the current geographical region of the doctor.</p></li>
<li><p>“Category” - the type of doctor, either ‘Specialist’ or ‘General Practitioner.’</p></li>
<li><p>“Rank” - is an internal ranking system. It is an ordered variable: The highest level is Ambassadors, followed by Titanium Plus, Titanium, Platinum Plus, Platinum, Gold Plus, Gold, Silver Plus, and the lowest level is Silver.</p></li>
<li><p>“Incidence rate”  and “R rate” - relate to the amount of re-work each doctor generates.</p></li>
<li><p>“Satisfaction” - measures doctors’ satisfaction with the company.</p></li>
<li><p>“Experience” - relates to the doctor’s experience with the company.</p></li>
<li><p>“Purchases” - purchases over the last year.</p></li>
</ul>
</div>
<div class="section" id="orders-contains-details-on-orders-each-row-represents-one-order-a-doctor-can-place-multiple-orders">
<h4>Orders contains details on orders. Each row represents one order; a doctor can place multiple orders.<a class="headerlink" href="#orders-contains-details-on-orders-each-row-represents-one-order-a-doctor-can-place-multiple-orders" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>“DoctorID” - doctor id (matches the other tables).</p></li>
<li><p>“OrderID” - order identifier.</p></li>
<li><p>“OrderNum” - order number.</p></li>
<li><p>“Conditions A through J” - map the different settings of the devices in each order. Each order goes to an individual patient.</p></li>
</ul>
</div>
<div class="section" id="complaints-collects-information-on-doctor-complaints">
<h4>Complaints collects information on doctor complaints.<a class="headerlink" href="#complaints-collects-information-on-doctor-complaints" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>“DoctorID” - doctor id (matches the other tables).</p></li>
<li><p>“Complaint Type” - the company’s classification of the complaints.</p></li>
<li><p>“Qty” - number of complaints per complaint type per doctor.</p></li>
</ul>
</div>
<div class="section" id="instructions-has-information-on-whether-the-doctor-includes-special-instructions-on-their-orders">
<h4>Instructions has information on whether the doctor includes special instructions on their orders.<a class="headerlink" href="#instructions-has-information-on-whether-the-doctor-includes-special-instructions-on-their-orders" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>“DoctorID” - doctor id (matches the other tables).</p></li>
<li><p>“Instructions” - ‘Yes’ when the doctor includes special instructions, ‘No’ when they do not.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doctors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/doctors.csv&#39;</span><span class="p">)</span>
<span class="n">orders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/orders.csv&#39;</span><span class="p">)</span>
<span class="n">complaints</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/complaints.csv&#39;</span><span class="p">)</span>
<span class="n">instructions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/instructions.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dqr</span><span class="p">(</span><span class="n">doctors</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DoctorID</th>
      <th>Region</th>
      <th>Category</th>
      <th>Rank</th>
      <th>Incidence rate</th>
      <th>R rate</th>
      <th>Satisfaction</th>
      <th>Experience</th>
      <th>Purchases</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AHDCBA</td>
      <td>4 15</td>
      <td>Specialist</td>
      <td>Ambassador</td>
      <td>49.0</td>
      <td>0.90</td>
      <td>53.85</td>
      <td>1.20</td>
      <td>49.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ABHAHF</td>
      <td>1 8 T4</td>
      <td>General Practitioner</td>
      <td>Ambassador</td>
      <td>37.0</td>
      <td>0.00</td>
      <td>100.00</td>
      <td>0.00</td>
      <td>38.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>FDHFJ</td>
      <td>1 9 T4</td>
      <td>Specialist</td>
      <td>Ambassador</td>
      <td>33.0</td>
      <td>1.53</td>
      <td>--</td>
      <td>0.00</td>
      <td>34.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>BJJHCA</td>
      <td>1 10 T3</td>
      <td>Specialist</td>
      <td>Ambassador</td>
      <td>28.0</td>
      <td>2.03</td>
      <td>--</td>
      <td>0.48</td>
      <td>29.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FJBEA</td>
      <td>1 14 T4</td>
      <td>Specialist</td>
      <td>Ambassador</td>
      <td>23.0</td>
      <td>0.96</td>
      <td>76.79</td>
      <td>0.75</td>
      <td>24.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Incidence rate</th>
      <td>437.0</td>
      <td>5.0</td>
      <td>4.2</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>49.0</td>
    </tr>
    <tr>
      <th>R rate</th>
      <td>437.0</td>
      <td>1.1</td>
      <td>0.7</td>
      <td>0.0</td>
      <td>0.6</td>
      <td>1.0</td>
      <td>1.5</td>
      <td>4.2</td>
    </tr>
    <tr>
      <th>Experience</th>
      <td>437.0</td>
      <td>0.5</td>
      <td>0.6</td>
      <td>0.0</td>
      <td>0.1</td>
      <td>0.4</td>
      <td>0.8</td>
      <td>5.4</td>
    </tr>
    <tr>
      <th>Purchases</th>
      <td>437.0</td>
      <td>10.8</td>
      <td>11.4</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>7.0</td>
      <td>13.0</td>
      <td>129.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Data Type</th>
      <th>Records</th>
      <th>Unique Values</th>
      <th>Missing Values</th>
      <th>Missing %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DoctorID</th>
      <td>object</td>
      <td>437</td>
      <td>437</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Region</th>
      <td>object</td>
      <td>437</td>
      <td>46</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Category</th>
      <td>object</td>
      <td>437</td>
      <td>2</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Rank</th>
      <td>object</td>
      <td>435</td>
      <td>9</td>
      <td>2</td>
      <td>0.46</td>
    </tr>
    <tr>
      <th>Incidence rate</th>
      <td>float64</td>
      <td>437</td>
      <td>63</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>R rate</th>
      <td>float64</td>
      <td>437</td>
      <td>137</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Satisfaction</th>
      <td>object</td>
      <td>437</td>
      <td>99</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Experience</th>
      <td>float64</td>
      <td>437</td>
      <td>106</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Purchases</th>
      <td>float64</td>
      <td>437</td>
      <td>45</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dqr</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DoctorID</th>
      <th>OrderID</th>
      <th>OrderNum</th>
      <th>Condition A</th>
      <th>Condition B</th>
      <th>Condition C</th>
      <th>Condition D</th>
      <th>Condition F</th>
      <th>Condition G</th>
      <th>Condition H</th>
      <th>Condition I</th>
      <th>Condition J</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ABJEAI</td>
      <td>DGEJFDC</td>
      <td>AIBEHCJ</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>Before</td>
    </tr>
    <tr>
      <th>1</th>
      <td>HBIEA</td>
      <td>DGAJDAH</td>
      <td>AIJIHGB</td>
      <td>False</td>
      <td>True</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>Before</td>
    </tr>
    <tr>
      <th>2</th>
      <td>GGCCD</td>
      <td>DGBBDCB</td>
      <td>AFEIHFB</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>EHHGF</td>
      <td>DGCDCCF</td>
      <td>AIBJJEE</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>Before</td>
    </tr>
    <tr>
      <th>4</th>
      <td>EHHGF</td>
      <td>DGCFAGC</td>
      <td>AEDBBDC</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>unique</th>
      <th>top</th>
      <th>freq</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DoctorID</th>
      <td>257</td>
      <td>76</td>
      <td>AAAEAH</td>
      <td>19</td>
    </tr>
    <tr>
      <th>OrderID</th>
      <td>257</td>
      <td>249</td>
      <td>DGJECBF</td>
      <td>2</td>
    </tr>
    <tr>
      <th>OrderNum</th>
      <td>257</td>
      <td>248</td>
      <td>AFFACIC</td>
      <td>2</td>
    </tr>
    <tr>
      <th>Condition A</th>
      <td>257</td>
      <td>2</td>
      <td>False</td>
      <td>224</td>
    </tr>
    <tr>
      <th>Condition B</th>
      <td>257</td>
      <td>2</td>
      <td>False</td>
      <td>221</td>
    </tr>
    <tr>
      <th>Condition C</th>
      <td>248</td>
      <td>2</td>
      <td>False</td>
      <td>217</td>
    </tr>
    <tr>
      <th>Condition D</th>
      <td>257</td>
      <td>2</td>
      <td>False</td>
      <td>223</td>
    </tr>
    <tr>
      <th>Condition F</th>
      <td>254</td>
      <td>2</td>
      <td>False</td>
      <td>253</td>
    </tr>
    <tr>
      <th>Condition G</th>
      <td>254</td>
      <td>2</td>
      <td>False</td>
      <td>208</td>
    </tr>
    <tr>
      <th>Condition H</th>
      <td>257</td>
      <td>2</td>
      <td>False</td>
      <td>184</td>
    </tr>
    <tr>
      <th>Condition I</th>
      <td>257</td>
      <td>2</td>
      <td>False</td>
      <td>238</td>
    </tr>
    <tr>
      <th>Condition J</th>
      <td>149</td>
      <td>2</td>
      <td>Before</td>
      <td>147</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Data Type</th>
      <th>Records</th>
      <th>Unique Values</th>
      <th>Missing Values</th>
      <th>Missing %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DoctorID</th>
      <td>object</td>
      <td>257</td>
      <td>76</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>OrderID</th>
      <td>object</td>
      <td>257</td>
      <td>249</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>OrderNum</th>
      <td>object</td>
      <td>257</td>
      <td>248</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Condition A</th>
      <td>bool</td>
      <td>257</td>
      <td>2</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Condition B</th>
      <td>bool</td>
      <td>257</td>
      <td>2</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Condition C</th>
      <td>object</td>
      <td>248</td>
      <td>2</td>
      <td>9</td>
      <td>3.50</td>
    </tr>
    <tr>
      <th>Condition D</th>
      <td>bool</td>
      <td>257</td>
      <td>2</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Condition F</th>
      <td>object</td>
      <td>254</td>
      <td>2</td>
      <td>3</td>
      <td>1.17</td>
    </tr>
    <tr>
      <th>Condition G</th>
      <td>object</td>
      <td>254</td>
      <td>2</td>
      <td>3</td>
      <td>1.17</td>
    </tr>
    <tr>
      <th>Condition H</th>
      <td>bool</td>
      <td>257</td>
      <td>2</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Condition I</th>
      <td>bool</td>
      <td>257</td>
      <td>2</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Condition J</th>
      <td>object</td>
      <td>149</td>
      <td>2</td>
      <td>108</td>
      <td>42.02</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dqr</span><span class="p">(</span><span class="n">complaints</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DoctorID</th>
      <th>Complaint Type</th>
      <th>Qty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>EHAHI</td>
      <td>Correct</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>EHDGF</td>
      <td>Correct</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>EHDGF</td>
      <td>Unknown</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>EHDIJ</td>
      <td>Correct</td>
      <td>8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>EHDIJ</td>
      <td>Incorrect</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Qty</th>
      <td>435.0</td>
      <td>1.8</td>
      <td>1.6</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>15.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Data Type</th>
      <th>Records</th>
      <th>Unique Values</th>
      <th>Missing Values</th>
      <th>Missing %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DoctorID</th>
      <td>object</td>
      <td>435</td>
      <td>284</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Complaint Type</th>
      <td>object</td>
      <td>433</td>
      <td>5</td>
      <td>2</td>
      <td>0.46</td>
    </tr>
    <tr>
      <th>Qty</th>
      <td>int64</td>
      <td>435</td>
      <td>12</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dqr</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DoctorID</th>
      <th>Instructions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ADIFBD</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ABHBED</td>
      <td>No</td>
    </tr>
    <tr>
      <th>2</th>
      <td>FJFEG</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AEBDAB</td>
      <td>No</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AJCBFE</td>
      <td>Yes</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>unique</th>
      <th>top</th>
      <th>freq</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DoctorID</th>
      <td>77</td>
      <td>77</td>
      <td>ADIFBD</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Instructions</th>
      <td>77</td>
      <td>2</td>
      <td>Yes</td>
      <td>67</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Data Type</th>
      <th>Records</th>
      <th>Unique Values</th>
      <th>Missing Values</th>
      <th>Missing %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DoctorID</th>
      <td>object</td>
      <td>77</td>
      <td>77</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Instructions</th>
      <td>object</td>
      <td>77</td>
      <td>2</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="buisness-questions">
<h2>3 Buisness Questions<a class="headerlink" href="#buisness-questions" title="Permalink to this headline">¶</a></h2>
<p>The sales and customer support departments have previously grouped doctors by geography. Let’s look into region information to see whether there are any signs that it is a good indicator.</p>
<div class="section" id="how-many-doctors-are-there-in-each-region">
<h3>3.1 How many doctors are there in each region?<a class="headerlink" href="#how-many-doctors-are-there-in-each-region" title="Permalink to this headline">¶</a></h3>
<p>We can find region information in the doctors table. Since each row represent one doctor, we then perform a groupby operation to count how many doctors there are in each region.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doctors_per_region</span> <span class="o">=</span> <span class="n">doctors</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Region&#39;</span><span class="p">)[</span><span class="s1">&#39;DoctorID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;DoctorID&quot;</span><span class="p">:</span> <span class="s2">&quot;Count&quot;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">doctors_per_region</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">doctors_per_region</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Region</th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6</th>
      <td>1 13</td>
      <td>34</td>
    </tr>
    <tr>
      <th>22</th>
      <td>1 9</td>
      <td>32</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1 14</td>
      <td>32</td>
    </tr>
    <tr>
      <th>12</th>
      <td>1 19</td>
      <td>31</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1 11</td>
      <td>23</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>46.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>9.500000</td>
    </tr>
    <tr>
      <th>std</th>
      <td>9.008021</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>12.500000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>34.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot region vs count</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Region&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">doctors_per_region</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Region&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Number of doctors in each region&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/doctor_segmentation_15_0.png" src="../../_images/doctor_segmentation_15_0.png" />
</div>
</div>
<p>The barplot above compares the number of doctors in each region. Region <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">13</span></code> has the most number of doctors, followed by <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">9</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">14</span></code>. The counts range from 1 to 34. The mean number of doctors across all regions is <code class="docutils literal notranslate"><span class="pre">10</span></code>, while the median is <code class="docutils literal notranslate"><span class="pre">6</span></code>. There is no observerable direct relationship between number of doctors and region.</p>
</div>
<div class="section" id="what-is-the-average-number-of-purchases-per-region">
<h3>3.2 What is the average number of purchases per region?<a class="headerlink" href="#what-is-the-average-number-of-purchases-per-region" title="Permalink to this headline">¶</a></h3>
<p>We can find region and purchases information in the doctors table. We will perform a groupby operation to aggregate the average number of purchases in each region.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">avg_purchases_per_region</span> <span class="o">=</span> <span class="n">doctors</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Region&#39;</span><span class="p">)[</span><span class="s1">&#39;Purchases&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;Purchases&quot;</span><span class="p">:</span> <span class="s2">&quot;Average purchases&quot;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">avg_purchases_per_region</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Average purchases&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">avg_purchases_per_region</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Region</th>
      <th>Average purchases</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>13</th>
      <td>1 19 20</td>
      <td>129.000000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1 13 T4</td>
      <td>30.000000</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1 19 T4</td>
      <td>25.333333</td>
    </tr>
    <tr>
      <th>24</th>
      <td>1 9 T4</td>
      <td>23.428571</td>
    </tr>
    <tr>
      <th>44</th>
      <td>4 15</td>
      <td>23.333333</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Average purchases</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>46.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>13.109296</td>
    </tr>
    <tr>
      <th>std</th>
      <td>18.662995</td>
    </tr>
    <tr>
      <th>min</th>
      <td>3.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>5.035714</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>10.145722</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>14.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>129.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot region vs average number of purchases</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Region&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Average purchases&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">avg_purchases_per_region</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Region&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Average number of purchases&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Average number of purchases in each region&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/doctor_segmentation_19_0.png" src="../../_images/doctor_segmentation_19_0.png" />
</div>
</div>
<p>The barplot above compares the average number of purchases in each region. Region <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">19</span> <span class="pre">20</span></code> has the highest average number of purchases of 129, however it can also be treated as a outlier because it is much larger than the other values in the dataset. The next highest region is <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">13</span> <span class="pre">T4</span></code> with 30 average purchases. The average number of purchases range from 3 to 129. Across the dataset, the mean number of purchases across all region is <code class="docutils literal notranslate"><span class="pre">13</span></code>, while the median is <code class="docutils literal notranslate"><span class="pre">10</span></code>. There is no observerable direct relationship between number of purchases and region.</p>
</div>
<div class="section" id="can-you-find-a-relationship-between-purchases-and-complaints">
<h3>3.3 Can you find a relationship between purchases and complaints?<a class="headerlink" href="#can-you-find-a-relationship-between-purchases-and-complaints" title="Permalink to this headline">¶</a></h3>
<p>Complaints information can be found complaints table. First let’s sum the quantity of complaints to <code class="docutils literal notranslate"><span class="pre">DoctorID</span></code>, then merge the complaints table with doctors table. There are also outliers, which are data values that are far away from other data values, which can strongly affect results. We will remove these outliers and calculate the correlation between the two variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Group and sum compliants by DoctorID</span>
<span class="n">complaints_group</span> <span class="o">=</span> <span class="n">complaints</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;DoctorID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="c1"># Merge complaints table to doctors table</span>
<span class="n">purchases_and_complaints</span> <span class="o">=</span> <span class="n">complaints_group</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">doctors</span><span class="p">[[</span><span class="s2">&quot;DoctorID&quot;</span><span class="p">,</span> <span class="s2">&quot;Purchases&quot;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;DoctorID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Remove outliers</span>
<span class="n">remove_outliers</span><span class="p">(</span><span class="n">purchases_and_complaints</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">purchases_and_complaints</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No. of instances where quantity of complaints were more than number of purchases </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">purchases_and_complaints</span><span class="p">[</span><span class="s1">&#39;Qty&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">purchases_and_complaints</span><span class="p">[</span><span class="s1">&#39;Purchases&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Print correlation between Purchases and Qty of complaints</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Correlation between purchases and quantity of complaints: </span><span class="si">{</span><span class="n">purchases_and_complaints</span><span class="p">[</span><span class="s1">&#39;Qty&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">purchases_and_complaints</span><span class="p">[</span><span class="s1">&#39;Purchases&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Plot Purchases vs Qty of complaints</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Qty&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Purchases&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">purchases_and_complaints</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">x_jitter</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Purchases&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Quantity&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Purchases vs Quantity of Complaints&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DoctorID</th>
      <th>Qty</th>
      <th>Purchases</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AAAEAH</td>
      <td>1</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AABDHC</td>
      <td>1</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AABGAB</td>
      <td>4</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AADDIG</td>
      <td>1</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AAEIEG</td>
      <td>2</td>
      <td>11.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No. of instances where quantity of complaints were more than number of purchases 7
Correlation between purchases and quantity of complaints: 0.01839142745208687
</pre></div>
</div>
<img alt="../../_images/doctor_segmentation_22_2.png" src="../../_images/doctor_segmentation_22_2.png" />
</div>
</div>
<p>Pearson’s Correlation coefficient is a measure for the strength of a linear relationship between two variables. A coefficient between 0.3 and 0.5 is generally considered as weak, meaning that the two variables show no strong linear relationship. A coefficient between 0.5 and 0.7 is considered as moderate, whereas a correlation between 0.7 and 0.9 is considered strong. The correlation number and regression plot shows the no relationship between number of purchases and quantity of complaints.</p>
<p>There are also instances where quantity of complaints is greater than number of purchases. This could possibly be due to 1. Data Error 2. Multiple complaints regarding to same purchase 3. Complaints to purchases over a year ago since <code class="docutils literal notranslate"><span class="pre">Purchases</span></code> only contains data about purchases over the last year.</p>
</div>
</div>
<div class="section" id="exploratory-data-analysis-eda">
<h2>4 Exploratory Data Analysis (EDA)<a class="headerlink" href="#exploratory-data-analysis-eda" title="Permalink to this headline">¶</a></h2>
<p>Let’s start by merging the four dataframes together. Next we will explore each column in the merged dataframe to better understand their type, distribution or frequency, and possible methods of addressing missing information.</p>
<p><strong>Summary</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DoctorID</span></code>, <code class="docutils literal notranslate"><span class="pre">OrderID</span></code>, <code class="docutils literal notranslate"><span class="pre">OrderNum</span></code> are IDs and will be dropped in modeling.</p></li>
<li><p>Fill missing categorical variables with “Missing” or drop rows</p></li>
<li><p>Fill missing numerical variables with 0, impute with mean/median, or drop rows</p></li>
<li><p>Encode categorical variables</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># list of dataframes to merge</span>
<span class="n">data_frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">doctors</span><span class="p">,</span> <span class="n">orders</span><span class="p">,</span> <span class="n">complaints</span><span class="p">,</span> <span class="n">instructions</span><span class="p">]</span>

<span class="n">df_merged</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DoctorID&#39;</span><span class="p">]),</span> <span class="n">data_frames</span><span class="p">)</span>

<span class="n">dqr</span><span class="p">(</span><span class="n">df_merged</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DoctorID</th>
      <th>Region</th>
      <th>Category</th>
      <th>Rank</th>
      <th>Incidence rate</th>
      <th>R rate</th>
      <th>Satisfaction</th>
      <th>Experience</th>
      <th>Purchases</th>
      <th>OrderID</th>
      <th>...</th>
      <th>Condition C</th>
      <th>Condition D</th>
      <th>Condition F</th>
      <th>Condition G</th>
      <th>Condition H</th>
      <th>Condition I</th>
      <th>Condition J</th>
      <th>Complaint Type</th>
      <th>Qty</th>
      <th>Instructions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AHDCBA</td>
      <td>4 15</td>
      <td>Specialist</td>
      <td>Ambassador</td>
      <td>49.0</td>
      <td>0.90</td>
      <td>53.85</td>
      <td>1.20</td>
      <td>49.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ABHAHF</td>
      <td>1 8 T4</td>
      <td>General Practitioner</td>
      <td>Ambassador</td>
      <td>37.0</td>
      <td>0.00</td>
      <td>100.00</td>
      <td>0.00</td>
      <td>38.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>FDHFJ</td>
      <td>1 9 T4</td>
      <td>Specialist</td>
      <td>Ambassador</td>
      <td>33.0</td>
      <td>1.53</td>
      <td>--</td>
      <td>0.00</td>
      <td>34.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>BJJHCA</td>
      <td>1 10 T3</td>
      <td>Specialist</td>
      <td>Ambassador</td>
      <td>28.0</td>
      <td>2.03</td>
      <td>--</td>
      <td>0.48</td>
      <td>29.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FJBEA</td>
      <td>1 14 T4</td>
      <td>Specialist</td>
      <td>Ambassador</td>
      <td>23.0</td>
      <td>0.96</td>
      <td>76.79</td>
      <td>0.75</td>
      <td>24.0</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 23 columns</p>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Incidence rate</th>
      <td>786.0</td>
      <td>4.8</td>
      <td>3.5</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.6</td>
      <td>49.0</td>
    </tr>
    <tr>
      <th>R rate</th>
      <td>786.0</td>
      <td>1.2</td>
      <td>0.8</td>
      <td>0.0</td>
      <td>0.8</td>
      <td>1.0</td>
      <td>1.5</td>
      <td>4.2</td>
    </tr>
    <tr>
      <th>Experience</th>
      <td>786.0</td>
      <td>0.6</td>
      <td>0.5</td>
      <td>0.0</td>
      <td>0.2</td>
      <td>0.6</td>
      <td>0.8</td>
      <td>5.4</td>
    </tr>
    <tr>
      <th>Purchases</th>
      <td>786.0</td>
      <td>13.8</td>
      <td>15.3</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>8.0</td>
      <td>16.0</td>
      <td>129.0</td>
    </tr>
    <tr>
      <th>Qty</th>
      <td>742.0</td>
      <td>1.8</td>
      <td>1.6</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>15.0</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Data Type</th>
      <th>Records</th>
      <th>Unique Values</th>
      <th>Missing Values</th>
      <th>Missing %</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DoctorID</th>
      <td>object</td>
      <td>1105</td>
      <td>647</td>
      <td>0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>Region</th>
      <td>object</td>
      <td>786</td>
      <td>46</td>
      <td>319</td>
      <td>28.87</td>
    </tr>
    <tr>
      <th>Category</th>
      <td>object</td>
      <td>786</td>
      <td>2</td>
      <td>319</td>
      <td>28.87</td>
    </tr>
    <tr>
      <th>Rank</th>
      <td>object</td>
      <td>784</td>
      <td>9</td>
      <td>321</td>
      <td>29.05</td>
    </tr>
    <tr>
      <th>Incidence rate</th>
      <td>float64</td>
      <td>786</td>
      <td>63</td>
      <td>319</td>
      <td>28.87</td>
    </tr>
    <tr>
      <th>R rate</th>
      <td>float64</td>
      <td>786</td>
      <td>137</td>
      <td>319</td>
      <td>28.87</td>
    </tr>
    <tr>
      <th>Satisfaction</th>
      <td>object</td>
      <td>786</td>
      <td>99</td>
      <td>319</td>
      <td>28.87</td>
    </tr>
    <tr>
      <th>Experience</th>
      <td>float64</td>
      <td>786</td>
      <td>106</td>
      <td>319</td>
      <td>28.87</td>
    </tr>
    <tr>
      <th>Purchases</th>
      <td>float64</td>
      <td>786</td>
      <td>45</td>
      <td>319</td>
      <td>28.87</td>
    </tr>
    <tr>
      <th>OrderID</th>
      <td>object</td>
      <td>434</td>
      <td>249</td>
      <td>671</td>
      <td>60.72</td>
    </tr>
    <tr>
      <th>OrderNum</th>
      <td>object</td>
      <td>434</td>
      <td>248</td>
      <td>671</td>
      <td>60.72</td>
    </tr>
    <tr>
      <th>Condition A</th>
      <td>object</td>
      <td>434</td>
      <td>2</td>
      <td>671</td>
      <td>60.72</td>
    </tr>
    <tr>
      <th>Condition B</th>
      <td>object</td>
      <td>434</td>
      <td>2</td>
      <td>671</td>
      <td>60.72</td>
    </tr>
    <tr>
      <th>Condition C</th>
      <td>object</td>
      <td>423</td>
      <td>2</td>
      <td>682</td>
      <td>61.72</td>
    </tr>
    <tr>
      <th>Condition D</th>
      <td>object</td>
      <td>434</td>
      <td>2</td>
      <td>671</td>
      <td>60.72</td>
    </tr>
    <tr>
      <th>Condition F</th>
      <td>object</td>
      <td>430</td>
      <td>2</td>
      <td>675</td>
      <td>61.09</td>
    </tr>
    <tr>
      <th>Condition G</th>
      <td>object</td>
      <td>430</td>
      <td>2</td>
      <td>675</td>
      <td>61.09</td>
    </tr>
    <tr>
      <th>Condition H</th>
      <td>object</td>
      <td>434</td>
      <td>2</td>
      <td>671</td>
      <td>60.72</td>
    </tr>
    <tr>
      <th>Condition I</th>
      <td>object</td>
      <td>434</td>
      <td>2</td>
      <td>671</td>
      <td>60.72</td>
    </tr>
    <tr>
      <th>Condition J</th>
      <td>object</td>
      <td>247</td>
      <td>2</td>
      <td>858</td>
      <td>77.65</td>
    </tr>
    <tr>
      <th>Complaint Type</th>
      <td>object</td>
      <td>740</td>
      <td>5</td>
      <td>365</td>
      <td>33.03</td>
    </tr>
    <tr>
      <th>Qty</th>
      <td>float64</td>
      <td>742</td>
      <td>12</td>
      <td>363</td>
      <td>32.85</td>
    </tr>
    <tr>
      <th>Instructions</th>
      <td>object</td>
      <td>172</td>
      <td>2</td>
      <td>933</td>
      <td>84.43</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msno</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df_merged</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/doctor_segmentation_26_0.png" src="../../_images/doctor_segmentation_26_0.png" />
</div>
</div>
<p>The y-axis scale ranges from 0.0 to 1.0, where 1.0 represents 100% data completeness. If the bar is less than this, it indicates that we have missing values within that column. <code class="docutils literal notranslate"><span class="pre">DoctorID</span></code> has 100% completeness while <code class="docutils literal notranslate"><span class="pre">Instructions</span></code> have the most number of missing values. This is expected because we used an outer join to merge the dataframes together.</p>
<div class="section" id="region">
<h3>4.1 Region<a class="headerlink" href="#region" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Categorical variable</p></li>
<li><p>Convert missing values to “Missing” variable or drop those rows</p></li>
<li><p>Since each row represents a Doctor review 3.1 for mode and countplot of region.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Region&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       4 15
1     1 8 T4
2     1 9 T4
3    1 10 T3
4    1 14 T4
Name: Region, dtype: object
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="category">
<h3>4.2 Category<a class="headerlink" href="#category" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Categorical variable, two categories: Specialist, or General Practitioner</p></li>
<li><p>Convert missing values to “Missing” variable or drop those rows</p></li>
<li><p>Most doctors are Specialists (707), only 79 doctors are General Practitioners</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

<span class="c1"># Plot countplot of Category</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Category&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Category&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Count of each Category&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0              Specialist
1    General Practitioner
2              Specialist
3              Specialist
4              Specialist
Name: Category, dtype: object
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Specialist&#39;, &#39;General Practitioner&#39;, nan], dtype=object)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Specialist              707
General Practitioner     79
Name: Category, dtype: int64
</pre></div>
</div>
<img alt="../../_images/doctor_segmentation_31_5.png" src="../../_images/doctor_segmentation_31_5.png" />
</div>
</div>
</div>
<div class="section" id="rank">
<h3>4.3 Rank<a class="headerlink" href="#rank" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Ordered Categorical variable, there are nine categories.</p></li>
<li><p>The highest rank is Ambassadors, followed by Titanium Plus, Titanium, Platinum Plus, Platinum, Gold Plus, Gold, Silver Plus, and the lowest level is Silver.</p></li>
<li><p>Data imbalance, only 1 Doctor is Rank Titanium Plus</p></li>
<li><p>Most common rank is Ambassador, least common Titanium Plus</p></li>
<li><p>Use ordinal encoding, where missing will be -1. However, this assumes that the numerical distance between each set of subsequent rank is equal.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Rank&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Rank&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Rank&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

<span class="c1"># Plot countplot of Rank</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Rank&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Rank&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Count of each Rank&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    Ambassador
1    Ambassador
2    Ambassador
3    Ambassador
4    Ambassador
Name: Rank, dtype: object
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Ambassador&#39;, &#39;Platinum Plus&#39;, &#39;Titanium&#39;, &#39;Silver Plus&#39;, &#39;Gold&#39;,
       &#39;Platinum&#39;, &#39;Gold Plus&#39;, &#39;Silver&#39;, nan, &#39;Titanium Plus&#39;],
      dtype=object)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ambassador       277
Platinum         146
Titanium         128
Gold Plus         79
Platinum Plus     73
Silver Plus       50
Gold              27
Silver             3
Titanium Plus      1
Name: Rank, dtype: int64
</pre></div>
</div>
<img alt="../../_images/doctor_segmentation_33_5.png" src="../../_images/doctor_segmentation_33_5.png" />
</div>
</div>
</div>
<div class="section" id="incidence-rate">
<h3>4.4 Incidence rate<a class="headerlink" href="#incidence-rate" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Numerical variable</p></li>
<li><p>Impute missing values with 0 or drop rows</p></li>
<li><p>Right skewed distribution ranging from 2 to 29 with a median of 4.</p></li>
<li><p>Apply log transformer to handle skewness</p></li>
<li><p>Possible outliers as seen in the boxplot, however will be kept because there is no indication this is incorrectly entered or measured data,</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Meidan: </span><span class="si">{</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skew: </span><span class="si">{</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Creating a figure composed of two matplotlib.Axes objects (ax_box and ax_hist)</span>
<span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_box</span><span class="p">,</span> <span class="n">ax_hist</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height_ratios&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">.15</span><span class="p">,</span> <span class="mf">.85</span><span class="p">)},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">)</span>

<span class="c1"># Assigning a graph to each ax</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_box</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_hist</span><span class="p">)</span>
 
<span class="c1"># Remove x axis name for the boxplot</span>
<span class="n">ax_box</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Boxplot and Histogram of Incidence rate&quot;</span><span class="p">)</span>
<span class="n">ax_hist</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    49.0
1    37.0
2    33.0
3    28.0
4    23.0
Name: Incidence rate, dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Meidan: 4.0
Skew: 5.607171363436355
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">StopIteration</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">line</span> <span class="mi">11</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="c1"># Assigning a graph to each ax</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_box</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">11</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_hist</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="c1"># Remove x axis name for the boxplot</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="n">ax_box</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Boxplot and Histogram of Incidence rate&quot;</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.14/x64/lib/python3.8/site-packages/seaborn/distributions.py:1418,</span> in <span class="ni">histplot</span><span class="nt">(data, x, y, hue, weights, stat, bins, binwidth, binrange, discrete, cumulative, common_bins, common_norm, multiple, element, fill, shrink, kde, kde_kws, line_kws, thresh, pthresh, pmax, cbar, cbar_ax, cbar_kws, palette, hue_order, hue_norm, color, log_scale, legend, ax, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1416</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1417</span>         <span class="n">method</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span>
<span class="ne">-&gt; </span><span class="mi">1418</span>     <span class="n">color</span> <span class="o">=</span> <span class="n">_default_color</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1420</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">has_xy_data</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1421</span>     <span class="k">return</span> <span class="n">ax</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.14/x64/lib/python3.8/site-packages/seaborn/utils.py:139,</span> in <span class="ni">_default_color</span><span class="nt">(method, hue, color, kws)</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span>     <span class="n">scout</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">136</span> <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;bar&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">137</span> 
<span class="g g-Whitespace">    </span><span class="mi">138</span>     <span class="c1"># bar() needs masked, not empty data, to generate a patch</span>
<span class="ne">--&gt; </span><span class="mi">139</span>     <span class="n">scout</span><span class="p">,</span> <span class="o">=</span> <span class="n">method</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">140</span>     <span class="n">color</span> <span class="o">=</span> <span class="n">to_rgb</span><span class="p">(</span><span class="n">scout</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">())</span>
<span class="g g-Whitespace">    </span><span class="mi">141</span>     <span class="n">scout</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.14/x64/lib/python3.8/site-packages/matplotlib/__init__.py:1423,</span> in <span class="ni">_preprocess_data.&lt;locals&gt;.inner</span><span class="nt">(ax, data, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1420</span> <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1421</span> <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1422</span>     <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1423</span>         <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="n">sanitize_sequence</span><span class="p">,</span> <span class="n">args</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1425</span>     <span class="n">bound</span> <span class="o">=</span> <span class="n">new_sig</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1426</span>     <span class="n">auto_label</span> <span class="o">=</span> <span class="p">(</span><span class="n">bound</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label_namer</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1427</span>                   <span class="ow">or</span> <span class="n">bound</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label_namer</span><span class="p">))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.14/x64/lib/python3.8/site-packages/matplotlib/axes/_axes.py:2373,</span> in <span class="ni">Axes.bar</span><span class="nt">(self, x, height, width, bottom, align, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2371</span> <span class="n">x0</span> <span class="o">=</span> <span class="n">x</span>
<span class="g g-Whitespace">   </span><span class="mi">2372</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_xunits</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="ne">-&gt; </span><span class="mi">2373</span> <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_dx</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_xunits</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2374</span> <span class="k">if</span> <span class="n">xerr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2375</span>     <span class="n">xerr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_dx</span><span class="p">(</span><span class="n">xerr</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_xunits</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.14/x64/lib/python3.8/site-packages/matplotlib/axes/_axes.py:2182,</span> in <span class="ni">Axes._convert_dx</span><span class="nt">(dx, x0, xconv, convert)</span>
<span class="g g-Whitespace">   </span><span class="mi">2170</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2171</span>     <span class="c1"># attempt to add the width to x0; this works for</span>
<span class="g g-Whitespace">   </span><span class="mi">2172</span>     <span class="c1"># datetime+timedelta, for instance</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2179</span>     <span class="c1"># removes the units from unit packages like `pint` that</span>
<span class="g g-Whitespace">   </span><span class="mi">2180</span>     <span class="c1"># wrap numpy arrays.</span>
<span class="g g-Whitespace">   </span><span class="mi">2181</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2182</span>         <span class="n">x0</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_safe_first_finite</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2183</span>     <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">2184</span>         <span class="k">pass</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.8.14/x64/lib/python3.8/site-packages/matplotlib/cbook/__init__.py:1749,</span> in <span class="ni">_safe_first_finite</span><span class="nt">(obj, skip_nonfinite)</span>
<span class="g g-Whitespace">   </span><span class="mi">1746</span>     <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;matplotlib does not &quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1747</span>                        <span class="s2">&quot;support generators as input&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1748</span> <span class="k">else</span><span class="p">:</span>
<span class="nn">-&gt; 1749     return next(val for val</span> in <span class="ni">obj if safe_isfinite</span><span class="nt">(val))</span>

<span class="ne">StopIteration</span>: 
</pre></div>
</div>
<img alt="../../_images/doctor_segmentation_35_3.png" src="../../_images/doctor_segmentation_35_3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skew of default: </span><span class="si">{</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skew of log transform: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skew of square-root transform: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skew of cube-root transform: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Plot histogram of logged Incidence rate</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">]),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histogram of logged Incidence rate&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Skew of default: 5.607171363436355
Skew of log transform: 1.2241053607140613
Skew of square-root transform: 2.619246516085647
Skew of cube-root transform: 2.025533508846419
</pre></div>
</div>
<img alt="../../_images/doctor_segmentation_36_1.png" src="../../_images/doctor_segmentation_36_1.png" />
</div>
</div>
</div>
<div class="section" id="r-rate">
<h3>4.5 R rate<a class="headerlink" href="#r-rate" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Numerical variable</p></li>
<li><p>Only positive values</p></li>
<li><p>Impute missing values with 0 or drop rows</p></li>
<li><p>Right skewed distribution ranging from 0 to 4.2 with a median of 1.</p></li>
<li><p>Possible outliers as seen in the boxplot, however will be kept because there is no indication this is incorrectly entered or measured data,</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;R rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Meidan: </span><span class="si">{</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;R rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skew: </span><span class="si">{</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;R rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Creating a figure composed of two matplotlib.Axes objects (ax_box and ax_hist)</span>
<span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_box</span><span class="p">,</span> <span class="n">ax_hist</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height_ratios&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">.15</span><span class="p">,</span> <span class="mf">.85</span><span class="p">)},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">)</span>

<span class="c1"># Assigning a graph to each ax</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;R rate&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_box</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;R rate&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_hist</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
 
<span class="c1"># Remove x axis name for the boxplot</span>
<span class="n">ax_box</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Boxplot and Histogram of R rate&quot;</span><span class="p">)</span>
<span class="n">ax_hist</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;R rate&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    0.90
1    0.00
2    1.53
3    2.03
4    0.96
Name: R rate, dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Meidan: 1.0
Skew: 1.8086653960068204
</pre></div>
</div>
<img alt="../../_images/doctor_segmentation_38_2.png" src="../../_images/doctor_segmentation_38_2.png" />
</div>
</div>
</div>
<div class="section" id="satisfaction">
<h3>4.6 Satisfaction<a class="headerlink" href="#satisfaction" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Numerical variable, spanning from -100 to 100</p></li>
<li><p>Contains some – characters, fill missing values with 0 or drop rows</p></li>
<li><p>When removing the “–” characters from the column, we see a left skewed distribution of the doctor’s satisfaction with the company.</p></li>
<li><p>The relation between mean, median, and mode is Mean &lt; Median &lt; Mode.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter rows in Satisfaction that match --</span>
<span class="n">dashes</span> <span class="o">=</span> <span class="n">doctors</span><span class="p">[</span><span class="s2">&quot;Satisfaction&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;--&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No. of dashes in Satisfaction: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">dashes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Remove dashes</span>
<span class="n">satisfaction</span> <span class="o">=</span> <span class="n">doctors</span><span class="p">[</span><span class="o">~</span><span class="n">dashes</span><span class="p">][</span><span class="s2">&quot;Satisfaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">satisfaction_med</span> <span class="o">=</span> <span class="n">satisfaction</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skew: </span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">satisfaction</span><span class="p">)</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">satisfaction</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1"># Creating a figure composed of two matplotlib.Axes objects (ax_box and ax_hist)</span>
<span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_box</span><span class="p">,</span> <span class="n">ax_hist</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height_ratios&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">.15</span><span class="p">,</span> <span class="mf">.85</span><span class="p">)},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">)</span>

<span class="c1"># Assigning a graph to each ax</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">satisfaction</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_box</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">satisfaction</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_hist</span><span class="p">)</span>

<span class="c1"># Remove x axis name for the boxplot</span>
<span class="n">ax_box</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Boxplot and Histogram of doctors&#39; satisfaction with the company&quot;</span><span class="p">)</span>
<span class="n">ax_hist</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Satisfaction&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No. of dashes in Satisfaction: 187
Skew: -0.662765167744903
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    250.000000
mean      29.218720
std       61.225893
min     -100.000000
25%      -12.315000
50%       39.230000
75%       83.330000
max      100.000000
Name: Satisfaction, dtype: float64
</pre></div>
</div>
<img alt="../../_images/doctor_segmentation_40_2.png" src="../../_images/doctor_segmentation_40_2.png" />
</div>
</div>
</div>
<div class="section" id="experience">
<h3>4.7 Experience<a class="headerlink" href="#experience" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Numerical variable</p></li>
<li><p>Only positive values as expected</p></li>
<li><p>Fill missing value with 0 or drop rows</p></li>
<li><p>Right skewed distribution ranging from 0 to 5.4, with a median of 0.57.</p></li>
<li><p>Possible outliers as seen in the boxplot, however will be kept because there is no indication this is incorrectly entered or measured data,</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Experience&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Meidan: </span><span class="si">{</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Experience&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skew: </span><span class="si">{</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Experience&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Creating a figure composed of two matplotlib.Axes objects (ax_box and ax_hist)</span>
<span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_box</span><span class="p">,</span> <span class="n">ax_hist</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height_ratios&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">.15</span><span class="p">,</span> <span class="mf">.85</span><span class="p">)},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">)</span>

<span class="c1"># Assigning a graph to each ax</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Experience&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_box</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Experience&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_hist</span><span class="p">)</span>

<span class="c1"># Remove x axis name for the boxplot</span>
<span class="n">ax_box</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Boxplot and Histogram of Experience&quot;</span><span class="p">)</span>
<span class="n">ax_hist</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Experience&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    1.20
1    0.00
2    0.00
3    0.48
4    0.75
Name: Experience, dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Meidan: 0.57
Skew: 2.711810861459008
</pre></div>
</div>
<img alt="../../_images/doctor_segmentation_42_2.png" src="../../_images/doctor_segmentation_42_2.png" />
</div>
</div>
</div>
<div class="section" id="purchases">
<h3>4.8 Purchases<a class="headerlink" href="#purchases" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Discrete Numerical variable</p></li>
<li><p>Only positive values as expected</p></li>
<li><p>Fill missing value with 0 or drop rows</p></li>
<li><p>Right skewed distribution ranging from 3 to 129 with a median of 8.</p></li>
<li><p>Possible outliers as seen in the boxplot, however will be kept because there is no indication this is incorrectly entered or measured data,</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Purchases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Meidan: </span><span class="si">{</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Purchases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skew: </span><span class="si">{</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Purchases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Creating a figure composed of two matplotlib.Axes objects (ax_box and ax_hist)</span>
<span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_box</span><span class="p">,</span> <span class="n">ax_hist</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height_ratios&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">.15</span><span class="p">,</span> <span class="mf">.85</span><span class="p">)},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">)</span>

<span class="c1"># Assigning a graph to each ax</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Purchases&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_box</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Purchases&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_hist</span><span class="p">)</span>

<span class="c1"># Remove x axis name for the boxplot</span>
<span class="n">ax_box</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Boxplot and Histogram of Purchases&quot;</span><span class="p">)</span>
<span class="n">ax_hist</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Purchases&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    49.0
1    38.0
2    34.0
3    29.0
4    24.0
Name: Purchases, dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Meidan: 8.0
Skew: 2.8726322076942634
</pre></div>
</div>
<img alt="../../_images/doctor_segmentation_44_2.png" src="../../_images/doctor_segmentation_44_2.png" />
</div>
</div>
</div>
<div class="section" id="condition-a-j">
<h3>4.9 Condition A-J<a class="headerlink" href="#condition-a-j" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>No Condition E</p></li>
<li><p>Boolean variable</p></li>
<li><p>Condition A-H are True, False</p></li>
<li><p>Condition J are Before, After</p></li>
<li><p>Fill missing variables with mode, or drop rows</p></li>
<li><p>Encode to 0 and 1</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot subplots of Condition A-J</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Count of each Condition&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Condition A&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Condition B&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Condition C&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Condition D&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Condition F&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Condition G&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Condition H&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Condition I&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Condition J&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/doctor_segmentation_46_0.png" src="../../_images/doctor_segmentation_46_0.png" />
</div>
</div>
</div>
<div class="section" id="complaint-type">
<h3>4.10 Complaint Type<a class="headerlink" href="#complaint-type" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Categorical variable</p></li>
<li><p>Most common complaint type is “Correct”</p></li>
<li><p>Convert missing values to “Missing” variable or drop those rows</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;Complaint Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

<span class="c1"># Plot countplot of Complaint Type</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Complaint Type&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Complaint Type&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Count of each Complaint Type&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Correct      355
Incorrect    220
Unknown      152
Specific      11
R&amp;R            2
Name: Complaint Type, dtype: int64
</pre></div>
</div>
<img alt="../../_images/doctor_segmentation_48_1.png" src="../../_images/doctor_segmentation_48_1.png" />
</div>
</div>
</div>
<div class="section" id="qty">
<h3>4.11 Qty<a class="headerlink" href="#qty" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Discrete numerical variable</p></li>
<li><p>Right skewed distribution, ranging from 1 to 15.</p></li>
<li><p>Fill missing with 0 or drop rows</p></li>
<li><p>Possible outliers as seen in the boxplot, however will be kept because there is no indication this is incorrectly entered or measured data,</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creating a figure composed of two matplotlib.Axes objects (ax_box and ax_hist)</span>
<span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">ax_box</span><span class="p">,</span> <span class="n">ax_hist</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height_ratios&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">.15</span><span class="p">,</span> <span class="mf">.85</span><span class="p">)},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">)</span>

<span class="c1"># Assigning a graph to each ax</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Qty&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_box</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Qty&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_hist</span><span class="p">)</span>

<span class="c1"># Remove x axis name for the boxplot</span>
<span class="n">ax_box</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Boxplot and Histogram of Qty&quot;</span><span class="p">)</span>
<span class="n">ax_hist</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Qty&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/doctor_segmentation_50_0.png" src="../../_images/doctor_segmentation_50_0.png" />
</div>
</div>
</div>
<div class="section" id="instructions">
<h3>4.12 Instructions<a class="headerlink" href="#instructions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Binary variable</p></li>
<li><p>Fill missing with “No”</p></li>
<li><p>Encode to 0, 1</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot countplot of Instructions</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Instructions&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Instructions&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Count of each Instructions&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/doctor_segmentation_52_0.png" src="../../_images/doctor_segmentation_52_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="feature-selection-and-engineering">
<h2>5 Feature Selection and Engineering<a class="headerlink" href="#feature-selection-and-engineering" title="Permalink to this headline">¶</a></h2>
<p>Based on our EDA, we recognize the dataset contains a mixture of identifier, categorical and continuous data, as well as missing values. We will now perform data preprocessing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of numerical columns</span>
<span class="n">num_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Incidence rate&#39;</span><span class="p">,</span> <span class="s1">&#39;R rate&#39;</span><span class="p">,</span> <span class="s1">&#39;Satisfaction&#39;</span><span class="p">,</span> <span class="s1">&#39;Experience&#39;</span><span class="p">,</span> <span class="s1">&#39;Purchases&#39;</span><span class="p">,</span> <span class="s1">&#39;Qty&#39;</span><span class="p">]</span>
<span class="c1"># List of categorical columns that could be one hot encoded</span>
<span class="n">cat_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Region&quot;</span><span class="p">,</span> <span class="s2">&quot;Category&quot;</span><span class="p">,</span> <span class="s2">&quot;Complaint Type&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dropping-identifiers-filling-missing-values-and-encoding">
<h3>5.1 Dropping identifiers, filling missing values, and encoding<a class="headerlink" href="#dropping-identifiers-filling-missing-values-and-encoding" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Drop ID columns</p></li>
<li><p>Fill in missing values</p></li>
<li><p>One hot encoding categorical variables</p></li>
<li><p>Ordinal encoding on Rank</p></li>
<li><p>Label Encoding on binary variables</p></li>
<li><p>Change type of column as approriate</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create function to perform preprocessing on dataframe</span>
<span class="k">def</span> <span class="nf">preproc</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform preprocessing (drop columns, fill missing values, encode columns) on dataframe</span>
<span class="sd">    </span>
<span class="sd">    ARGS:</span>
<span class="sd">    df (dataframe): Pandas dataframe</span>
<span class="sd">    </span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    Preprocessed dataframe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Drop ID columns</span>
    <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;DoctorID&quot;</span><span class="p">,</span> <span class="s2">&quot;OrderID&quot;</span><span class="p">,</span> <span class="s2">&quot;OrderNum&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Fill missing Region values</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Region&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;Missing&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Region&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Region&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
    <span class="c1"># Fill missing Category values</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;Missing&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Ordinal Encode Rank values, fill missing with -1</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Rank&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Silver&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                 <span class="s1">&#39;Silver Plus&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> 
                 <span class="s1">&#39;Gold&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> 
                 <span class="s1">&#39;Gold Plus&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> 
                 <span class="s1">&#39;Platinum&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> 
                 <span class="s1">&#39;Platinum Plus&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> 
                 <span class="s1">&#39;Titanium&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> 
                 <span class="s1">&#39;Titanium Plus&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> 
                 <span class="s1">&#39;Ambassador&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Rank&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Fill missing Incidence rate values</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="c1"># Fill missing R rate values</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;R rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;R rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="c1"># Replace -- rows, and fill missing Satifactions values with 0</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Satisfaction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Satisfaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Satisfaction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Satisfaction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="c1"># Fill missing Experience values</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Experience&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Experience&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="c1"># Fill missing Purchases values</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Purchases&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Purchases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>    
    <span class="c1"># Encode boolean columns</span>
    <span class="n">enc</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;encoder&quot;</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">()),</span>
        <span class="p">(</span><span class="s2">&quot;imputer&quot;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
    <span class="p">])</span>
    <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Condition A&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;Condition B&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;Condition C&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;Condition D&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;Condition F&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;Condition G&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;Condition H&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;Condition I&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Condition A&quot;</span><span class="p">,</span> 
                                                      <span class="s2">&quot;Condition B&quot;</span><span class="p">,</span> 
                                                      <span class="s2">&quot;Condition C&quot;</span><span class="p">,</span> 
                                                      <span class="s2">&quot;Condition D&quot;</span><span class="p">,</span> 
                                                      <span class="s2">&quot;Condition F&quot;</span><span class="p">,</span> 
                                                      <span class="s2">&quot;Condition G&quot;</span><span class="p">,</span> 
                                                      <span class="s2">&quot;Condition H&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;Condition I&quot;</span><span class="p">]])</span>
    <span class="c1"># Encode Condition J, fill mising with -1</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Condition J&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Condition J&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Before&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                               <span class="s2">&quot;After&quot;</span><span class="p">:</span> <span class="mi">1</span>
                                              <span class="p">})</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Condition J&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Fill missing Complaint Type values</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Complaint Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;Missing&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Fill missing Qty values</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Qty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Qty&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="c1"># Encode Instructions, fill mising with 0</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Instructions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Instructions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;No&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                                               <span class="s2">&quot;Yes&quot;</span><span class="p">:</span> <span class="mi">1</span>
                                              <span class="p">})</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Instructions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># One hot encoding on categorical columns</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cat_cols</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">processed_df</span> <span class="o">=</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">processed_df</span> <span class="o">=</span> <span class="n">preproc</span><span class="p">(</span><span class="n">processed_df</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">processed_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">processed_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Rank&#39;, &#39;Incidence rate&#39;, &#39;R rate&#39;, &#39;Satisfaction&#39;, &#39;Experience&#39;,
       &#39;Purchases&#39;, &#39;Condition A&#39;, &#39;Condition B&#39;, &#39;Condition C&#39;, &#39;Condition D&#39;,
       &#39;Condition F&#39;, &#39;Condition G&#39;, &#39;Condition H&#39;, &#39;Condition I&#39;,
       &#39;Condition J&#39;, &#39;Qty&#39;, &#39;Instructions&#39;, &#39;Region_1 10&#39;, &#39;Region_1 10 T3&#39;,
       &#39;Region_1 11&#39;, &#39;Region_1 12&#39;, &#39;Region_1 12 T3&#39;, &#39;Region_1 12 T4&#39;,
       &#39;Region_1 13&#39;, &#39;Region_1 13 T3&#39;, &#39;Region_1 13 T4&#39;, &#39;Region_1 14&#39;,
       &#39;Region_1 14 T3&#39;, &#39;Region_1 14 T4&#39;, &#39;Region_1 19&#39;, &#39;Region_1 19 20&#39;,
       &#39;Region_1 19 T3&#39;, &#39;Region_1 19 T4&#39;, &#39;Region_1 21 T3&#39;, &#39;Region_1 21 T4&#39;,
       &#39;Region_1 4CP&#39;, &#39;Region_1 8&#39;, &#39;Region_1 8 T3&#39;, &#39;Region_1 8 T4&#39;,
       &#39;Region_1 9&#39;, &#39;Region_1 9 T3&#39;, &#39;Region_1 9 T4&#39;, &#39;Region_17&#39;,
       &#39;Region_2 11&#39;, &#39;Region_2 6 10&#39;, &#39;Region_2 6 12&#39;, &#39;Region_2 6 13&#39;,
       &#39;Region_2 6 14&#39;, &#39;Region_2 6 19&#39;, &#39;Region_2 6 8&#39;, &#39;Region_2 6 9&#39;,
       &#39;Region_2 7 10&#39;, &#39;Region_2 7 12&#39;, &#39;Region_2 7 13&#39;, &#39;Region_2 7 14&#39;,
       &#39;Region_2 7 19&#39;, &#39;Region_2 7 8&#39;, &#39;Region_2 7 9&#39;, &#39;Region_22 18&#39;,
       &#39;Region_23 3&#39;, &#39;Region_3 16&#39;, &#39;Region_4 15&#39;, &#39;Region_5 18&#39;,
       &#39;Region_Missing&#39;, &#39;Category_General Practitioner&#39;, &#39;Category_Missing&#39;,
       &#39;Category_Specialist&#39;, &#39;Complaint Type_Correct&#39;,
       &#39;Complaint Type_Incorrect&#39;, &#39;Complaint Type_Missing&#39;,
       &#39;Complaint Type_R&amp;R&#39;, &#39;Complaint Type_Specific&#39;,
       &#39;Complaint Type_Unknown&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of features: 73
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rank</th>
      <th>Incidence rate</th>
      <th>R rate</th>
      <th>Satisfaction</th>
      <th>Experience</th>
      <th>Purchases</th>
      <th>Condition A</th>
      <th>Condition B</th>
      <th>Condition C</th>
      <th>Condition D</th>
      <th>...</th>
      <th>Region_Missing</th>
      <th>Category_General Practitioner</th>
      <th>Category_Missing</th>
      <th>Category_Specialist</th>
      <th>Complaint Type_Correct</th>
      <th>Complaint Type_Incorrect</th>
      <th>Complaint Type_Missing</th>
      <th>Complaint Type_R&amp;R</th>
      <th>Complaint Type_Specific</th>
      <th>Complaint Type_Unknown</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8.0</td>
      <td>49.0</td>
      <td>0.90</td>
      <td>53.85</td>
      <td>1.20</td>
      <td>49.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8.0</td>
      <td>37.0</td>
      <td>0.00</td>
      <td>100.00</td>
      <td>0.00</td>
      <td>38.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8.0</td>
      <td>33.0</td>
      <td>1.53</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>34.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8.0</td>
      <td>28.0</td>
      <td>2.03</td>
      <td>0.00</td>
      <td>0.48</td>
      <td>29.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8.0</td>
      <td>23.0</td>
      <td>0.96</td>
      <td>76.79</td>
      <td>0.75</td>
      <td>24.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 73 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="feature-scaling">
<h3>5.2 Feature Scaling<a class="headerlink" href="#feature-scaling" title="Permalink to this headline">¶</a></h3>
<p>Using <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html">MinMaxScaler</a> to make sure features with different scales don’t introduce bias into clustering</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scale numerical features</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">scaled_df</span> <span class="o">=</span> <span class="n">processed_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">scaled_df</span><span class="p">[</span><span class="n">num_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">scaled_df</span><span class="p">[</span><span class="n">num_cols</span><span class="p">]),</span> 
                               <span class="n">index</span><span class="o">=</span><span class="n">scaled_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="principal-component-analysis-pca">
<h3>5.3 Principal Component Analysis (PCA)<a class="headerlink" href="#principal-component-analysis-pca" title="Permalink to this headline">¶</a></h3>
<p>This method is used to reduce the dimensionality of the dataset. Let have set up a loop function to identify number of principal components that explain at least 85% of the variance in the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RANDOM_STATE</span> <span class="o">=</span> <span class="mi">23</span>

<span class="c1"># Loop Function to identify number of principal components that explain at least 85% of the variance</span>
<span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">scaled_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">comp</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">)</span>
    <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">scaled_df</span><span class="p">)</span>
    <span class="n">comp_check</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
    <span class="n">n_comp</span> <span class="o">=</span> <span class="n">comp</span>
    <span class="k">if</span> <span class="n">comp_check</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.85</span><span class="p">:</span>
        <span class="k">break</span>
        
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_comp</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">)</span>
<span class="n">pca_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">scaled_df</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">scaled_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">num_comps</span> <span class="o">=</span> <span class="n">comp_check</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using </span><span class="si">{}</span><span class="s2"> components, we can explain </span><span class="si">{}% o</span><span class="s2">f the variability in the original data.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_comp</span><span class="p">,</span> <span class="n">comp_check</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
<span class="n">pca_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using 2 components, we can explain 87.06746784108557% of the variability in the original data.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-4.474670</td>
      <td>-0.669163</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-4.334824</td>
      <td>-0.723871</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-4.443076</td>
      <td>-0.706745</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-4.443955</td>
      <td>-0.714453</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-4.441273</td>
      <td>-0.707036</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="define-new-doctor-segments">
<h2>6 Define new doctor segments<a class="headerlink" href="#define-new-doctor-segments" title="Permalink to this headline">¶</a></h2>
<p>Our objective is to help the company improve their marketing efforts and customer service by creating new doctor segments from an unlabeled dataset, hence an unsupervised machine learning and clustering appears to be the most reasonable choice of the model. Clustering divides a set of objects or observations (in this case doctors) into different groups based on their features or properties. The division is done in such that the observations are as similar as possible to each other within the same cluster. In addition, each cluster should be as far away from the others as possible.</p>
<div class="section" id="optimal-number-of-clusters">
<h3>6.1 Optimal number of clusters<a class="headerlink" href="#optimal-number-of-clusters" title="Permalink to this headline">¶</a></h3>
<p>We will use the elbow method to determe the optimal number of clusters. The method calculates the Within-Cluster-Sum of Squared Errors (WSS) for different number of clusters (k) and selecting the k for which change in WSS first starts to diminish.</p>
<ul class="simple">
<li><p>Based on the distortion score at different k, 5 is the optimal number of clusters.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Elbow method using yellowbrick library</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">()</span>
<span class="c1"># k is range of number of clusters.</span>
<span class="n">visualizer</span> <span class="o">=</span> <span class="n">KElbowVisualizer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span> <span class="n">timings</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pca_df</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/doctor_segmentation_64_0.png" src="../../_images/doctor_segmentation_64_0.png" />
</div>
</div>
</div>
<div class="section" id="kmeans-clustering">
<h3>6.2 KMeans clustering<a class="headerlink" href="#kmeans-clustering" title="Permalink to this headline">¶</a></h3>
<p>KMeans is an iterative algorithm that partitions the dataset into K pre-defined distinct non-overlapping subgroups (clusters) where each data point belongs to only one group.</p>
<p>The graph shows the scatter plot of the data colored by the cluster they belong to based on their similarity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">km</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pca_df</span><span class="p">)</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">km</span><span class="o">.</span><span class="n">labels_</span>

<span class="c1"># Getting unique labels</span>
<span class="n">u_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">u_labels</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pca_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">label</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="n">pca_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">label</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;PCA 1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;PCA 2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Visualization of clustered data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/doctor_segmentation_66_0.png" src="../../_images/doctor_segmentation_66_0.png" />
</div>
</div>
</div>
<div class="section" id="which-features-impact-the-new-segmentation-strategy-the-most">
<h3>6.3 Which features impact the new segmentation strategy the most<a class="headerlink" href="#which-features-impact-the-new-segmentation-strategy-the-most" title="Permalink to this headline">¶</a></h3>
<p>Now that we have identified our clusters, let’s extract each cluster’s most important features. One approach is to convert the unsupervised clustering problem into a One-vs-All supervised classification problem.</p>
<ol class="simple">
<li><p>Change the cluster labels into One-vs-All binary labels</p></li>
<li><p>Train a classifier to discriminate between each cluster and all other clusters</p></li>
<li><p>Extract the feature importances from the model (We will be using sklearn.ensemble.RandomForestClassifier)</p></li>
</ol>
<p>From the weights we identify <code class="docutils literal notranslate"><span class="pre">Rank</span></code> as the most important feature, this is usually followed by purchases and R rate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaled_df</span><span class="p">[</span><span class="s2">&quot;Cluster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
<span class="n">scaled_df</span><span class="p">[</span><span class="s1">&#39;Binary Cluster 0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled_df</span><span class="p">[</span><span class="s1">&#39;Cluster&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>
<span class="n">scaled_df</span><span class="p">[</span><span class="s1">&#39;Binary Cluster 1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled_df</span><span class="p">[</span><span class="s1">&#39;Cluster&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>
<span class="n">scaled_df</span><span class="p">[</span><span class="s1">&#39;Binary Cluster 2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled_df</span><span class="p">[</span><span class="s1">&#39;Cluster&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>
<span class="n">scaled_df</span><span class="p">[</span><span class="s1">&#39;Binary Cluster 3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled_df</span><span class="p">[</span><span class="s1">&#39;Cluster&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>
<span class="n">scaled_df</span><span class="p">[</span><span class="s1">&#39;Binary Cluster 4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled_df</span><span class="p">[</span><span class="s1">&#39;Cluster&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>

<span class="c1"># Train a classifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="n">scaled_df_train</span> <span class="o">=</span> <span class="n">scaled_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;Cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;Binary Cluster 0&quot;</span><span class="p">,</span> <span class="s2">&quot;Binary Cluster 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Binary Cluster 2&quot;</span><span class="p">,</span> <span class="s2">&quot;Binary Cluster 3&quot;</span><span class="p">,</span> <span class="s2">&quot;Binary Cluster 4&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">)</span>
    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">scaled_df_train</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">scaled_df</span><span class="p">[</span><span class="s2">&quot;Binary Cluster &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="c1"># Index sort the most important features</span>
    <span class="n">sorted_feature_weight_idxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Reverse sort</span>
    <span class="c1"># Get the most important features names and weights</span>
    <span class="n">most_important_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take_along_axis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scaled_df_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span> <span class="n">sorted_feature_weight_idxes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">most_important_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take_along_axis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">),</span> <span class="n">sorted_feature_weight_idxes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Show</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">most_important_features</span><span class="p">,</span> <span class="n">most_important_weights</span><span class="p">))[:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;Rank&#39;, 0.3462422263806552), (&#39;R rate&#39;, 0.060365456749001456), (&#39;Category_General Practitioner&#39;, 0.05741863343778913)]
[(&#39;Rank&#39;, 0.36374424881372586), (&#39;Purchases&#39;, 0.08363203178543055), (&#39;Region_1 8 T3&#39;, 0.06992636245787862)]
[(&#39;Rank&#39;, 0.16906243640382515), (&#39;Category_Missing&#39;, 0.16547351972134908), (&#39;Purchases&#39;, 0.16081255501034938)]
[(&#39;Rank&#39;, 0.44233890242367024), (&#39;Purchases&#39;, 0.16679337117408138), (&#39;R rate&#39;, 0.06584395381200006)]
[(&#39;Rank&#39;, 0.3689971859520564), (&#39;Purchases&#39;, 0.10372479238158124), (&#39;R rate&#39;, 0.09107045419109543)]
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="characteristics-that-distinguish-the-newly-defined-segments">
<h2>7 Characteristics that distinguish the newly defined segments<a class="headerlink" href="#characteristics-that-distinguish-the-newly-defined-segments" title="Permalink to this headline">¶</a></h2>
<p>Now that we have identified new doctor segments, let’s identify their characteristics.</p>
<p>Each cluster contains the following groups of <code class="docutils literal notranslate"><span class="pre">Ranks</span></code>:</p>
<ul class="simple">
<li><p>Silver, Silver Plus, Gold</p></li>
<li><p>Gold Plus, “Platinum</p></li>
<li><p>Platinum Plus, Titanium</p></li>
<li><p>Titanium Plus, Ambassador</p></li>
<li><p>Missing</p></li>
</ul>
<p>Let’s also explore whether other columns have any relationships with feature <code class="docutils literal notranslate"><span class="pre">Rank</span></code>. By calculating the pairwise correlation, we see that it suggests a strong positive relationship with <code class="docutils literal notranslate"><span class="pre">Purchases</span></code>, and a moderate positive relationship with <code class="docutils literal notranslate"><span class="pre">Incidence</span> <span class="pre">rate</span></code>, <code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">rate</span></code>. We can dismiss <code class="docutils literal notranslate"><span class="pre">Category_Specialist</span></code>, because as seen in 4.2, most doctors are categorized as specialists.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster_df</span> <span class="o">=</span> <span class="n">scaled_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Groupby cluster</span>
<span class="n">display</span><span class="p">(</span><span class="n">cluster_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Cluster&quot;</span><span class="p">)[</span><span class="s2">&quot;Rank&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="c1"># Rank&#39;s correlation with other columns</span>
<span class="n">rank_corr</span> <span class="o">=</span> <span class="n">scaled_df_train</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">scaled_df</span><span class="p">[</span><span class="s1">&#39;Rank&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;Column&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;Correlation&quot;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">rank_corr</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cluster  Rank
0         1.0     50
          2.0     27
          0.0      3
1         6.0    128
          5.0     73
2        -1.0    321
3         8.0    277
          7.0      1
4         4.0    146
          3.0     79
Name: Rank, dtype: int64
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Column</th>
      <th>Correlation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Rank</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>66</th>
      <td>Category_Specialist</td>
      <td>0.797082</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Purchases</td>
      <td>0.631280</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Incidence rate</td>
      <td>0.526836</td>
    </tr>
    <tr>
      <th>2</th>
      <td>R rate</td>
      <td>0.441926</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="rank-vs-purchases">
<h3>7.1 Rank vs Purchases<a class="headerlink" href="#rank-vs-purchases" title="Permalink to this headline">¶</a></h3>
<p>From the violin plot, we can see there is a positive relationship between Rank and Purchases, where the higher Ranks have a higher number of purchases. This is also seen in the median number of purchases of each rank,  with the exception of Silver Rank. Therefore, Rank is helpful indicator in predicting the number of purchases a doctor will make. Ambassador Rank has the highest number of purchases, with a high of 129 purchases. Titanium Plus looks like an outlier on the violin plot, but this can be attributed to having a small sample size of doctors in that rank.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rank_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Silver&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Silver Plus&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Gold&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Platinum&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Platinum Plus&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Titanium&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Titanium Plus&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Ambassador&#39;</span><span class="p">]</span>

<span class="n">rank_df</span> <span class="o">=</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># Calculate median for each rank group</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median number of Purchases by Rank&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">rank_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Rank&quot;</span><span class="p">)[</span><span class="s2">&quot;Purchases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">rank_order</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max number of Purchases by Rank&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">rank_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Rank&quot;</span><span class="p">)[</span><span class="s2">&quot;Purchases&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">rank_order</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Rank&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Purchases&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_merged</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">rank_order</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Violin plot of Purchases based on Rank&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Median number of Purchases by Rank
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rank
Silver            7.0
Silver Plus       4.0
Gold              3.0
Platinum          5.0
Platinum Plus     7.0
Titanium         10.0
Titanium Plus    14.0
Ambassador       20.0
Name: Purchases, dtype: float64
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Max number of Purchases by Rank
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rank
Silver             8.0
Silver Plus       14.0
Gold              14.0
Platinum          16.0
Platinum Plus     24.0
Titanium          45.0
Titanium Plus     14.0
Ambassador       129.0
Name: Purchases, dtype: float64
</pre></div>
</div>
<img alt="../../_images/doctor_segmentation_72_4.png" src="../../_images/doctor_segmentation_72_4.png" />
</div>
</div>
</div>
<div class="section" id="rank-vs-incidence-rate-and-r-rate">
<h3>7.2 Rank vs Incidence rate and R rate<a class="headerlink" href="#rank-vs-incidence-rate-and-r-rate" title="Permalink to this headline">¶</a></h3>
<p>On the other hand, it is less certain whether there is a clear trend between Rank and Incidence rate or Rank and R rate. Therefore, Rank is a moderate indicator on the amount of rework a doctor generates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate median for each rank group</span>
<span class="n">display</span><span class="p">(</span><span class="n">rank_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Rank&quot;</span><span class="p">)[</span><span class="s2">&quot;Incidence rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">rank_order</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">rank_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Rank&quot;</span><span class="p">)[</span><span class="s2">&quot;R rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">rank_order</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rank
Silver           7.0
Silver Plus      3.0
Gold             3.0
Platinum         5.0
Platinum Plus    4.0
Titanium         4.0
Titanium Plus    2.5
Ambassador       4.0
Name: Incidence rate, dtype: float64
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Rank
Silver           1.13
Silver Plus      0.33
Gold             1.00
Platinum         1.25
Platinum Plus    1.25
Titanium         1.20
Titanium Plus    1.64
Ambassador       0.85
Name: R rate, dtype: float64
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="conclusion">
<h2>8. Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>From our analysis in 3.2 we consider that grouping doctors by geography is a poor predictor of the number of purchases a doctor will make or their support needs. In addition, there is no relationship between number of purchases and number of complaints as seen in 3.3.</p>
<p>We move to use a data-centric approach to segment the doctors by using unsupervised machine learning to cluster them based on their features from the tables <code class="docutils literal notranslate"><span class="pre">Doctors</span></code>, <code class="docutils literal notranslate"><span class="pre">Orders</span></code>, <code class="docutils literal notranslate"><span class="pre">Complaints</span></code>, <code class="docutils literal notranslate"><span class="pre">Instructions</span></code>. The model we use for clustering is KMeans and it has grouped the doctors into 5 clusters as seen in section 6. We find that <code class="docutils literal notranslate"><span class="pre">Rank</span></code> impacts the new segmentation strategy the most and also detect a positive relationship between <code class="docutils literal notranslate"><span class="pre">Rank</span></code> and <code class="docutils literal notranslate"><span class="pre">Purchases</span></code>.</p>
<p><strong>Clusters based on Rank:</strong></p>
<ul class="simple">
<li><p>Silver, Silver Plus, Gold</p></li>
<li><p>Gold Plus, “Platinum</p></li>
<li><p>Platinum Plus, Titanium</p></li>
<li><p>Titanium Plus, Ambassador</p></li>
<li><p>Missing</p></li>
</ul>
<p>In conclusion, we recommend the company to base their marketing efforts and customer services based on <code class="docutils literal notranslate"><span class="pre">Rank</span></code>, which is their internal ranking system.</p>
<p><strong>Weaknesses:</strong></p>
<ul class="simple">
<li><p>Though it is unknown how a doctor’s <code class="docutils literal notranslate"><span class="pre">Rank</span></code> is generated. While, it is a good predictor for the number a doctor will make, it is not a direct indicator of their support needs.</p></li>
<li><p>While Ordinal encoding of Rank captured the ordering of the variable, it assumes that each rank is of equal distance to each other. Perhaps the gap between Titanium and Titanium Plus is small, however the jump to Ambassador is much larger etc. and the encoding does not represent that.</p></li>
</ul>
<div class="section" id="next-steps">
<h3>8.1 Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h3>
<p>To build upon this analysis, we recommend doing the following:</p>
<ul class="simple">
<li><p>Understand how <code class="docutils literal notranslate"><span class="pre">Rank</span></code> is generated</p></li>
<li><p>More data collection to address data imbalance, and reduce proportion of missing values.</p></li>
<li><p>Further feature engineering and selection, e.g. explore other ways of imputing missing values.</p></li>
<li><p>Explore different clustering models besides KMeans. Drawbacks to KMeans include being unable to handle noisy data and outliers, as well as not being suitable to identify clusters with non-convex shapes.</p></li>
<li><p>Alternatives to interpreting the clusters (our approach was using a Random Forest Classifier)</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./projects/doctor_segmentation"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Projects
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   Customer Segmentation for Medical Device Manufacturer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../inn_the_neighborhood/inn_the_neighborhood.html">
   Rental Price Prediction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../concrete_strength/concrete_strength.html">
   Predict Concrete Strength
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../chocolate_bars/chocolate_bars.html">
   Finding the best Chocolate Bars
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../travel_assured/travel_assured.html">
   Travel Insurance Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../exam_scores/exam_scores.html">
   Do test preparation courses help you prepare for exams?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../viral_tweets/README.html">
   Viral Tweets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../stock_sentiment_from_headlines/stock_sentiment_from_headlines.html">
   Stock Sentiment Analysis from News Headlines
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../BCG/README.html">
   PowerCo - Is Churn driven by price sensitivity?
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../BCG/PowerCo_email.html">
     PowerCo - Proposal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../BCG/eda.html">
     PowerCo - EDA
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../sms_classifier/README.html">
   SMS Text Classification
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../sms_classifier/sms_classification.html">
     Neural Network - SMS Text Classification
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Achievements
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../achievements/certificates.html">
   Certifications
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="../../intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="" title=""><span class="show-for-sr"></span></a></li>
                    <!-- <li class="btn__search">
                        <form action="../../search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off">
                            <i data-feather="search"></i>
                        </form>
                    </li> -->
                </ul>

                <ul class="qe-toolbar__links">
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/shpatrickguo/dsprojects/tree/main/projects/doctor_segmentation/doctor_segmentation.ipynb" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="" data-urlpath="" data-branch=>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "projects/doctor_segmentation/doctor_segmentation";
                const repoURL = "";
                const urlPath = "";
                const branch = ""
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
    
  </body>
</html>